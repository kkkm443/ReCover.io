<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RE:COVER</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
		@font-face {
            font-family: 'Toss Face';
            src: url('https://cdn.jsdelivr.net/gh/toss/tossface/dist/TossFaceFontMac.ttf') format('truetype');
            font-display: swap;
			unicode-range: U+1F000-1FAFF, U+2600-26FF, U+2700-27BF, U+2300-23FF, U+2B50, U+2B55, U+2934, U+2935;
        }
        /* =========================================
           1. DESIGN SYSTEM
           ========================================= */
        :root {
            --brand: #4496F5;
            --brand-sub: #E3F2FD;
            --healing: #00D2BA;
            --danger: #FF6B6B;
            --admin: #2C3E50;
            --text-main: #333;
            --bg-base: #F5F7FA;
            --card-white: #ffffff;
            --disconnected: #95a5a6;
            --toggle-off: #ccc;
            --toggle-on: #0066FF;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
        }

        body { 
            margin: 0; 
            background: var(--bg-base); 
			font-family: "Toss Face", -apple-system, BlinkMacSystemFont, "Pretendard", sans-serif;
            display: flex; 
            justify-content: center; 
            height: 100vh; 
            color: var(--text-main); 
            overflow: hidden; 
        }

        #app-frame { 
            width: 100%; 
            max-width: 450px; 
            height: 100%; 
            background: var(--bg-base); 
            position: relative; 
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 0 30px rgba(0,0,0,0.1); 
        }
        
        /* =========================================
           2. HEADER & WATCH BAR
           ========================================= */
        header { 
            background: var(--card-white); 
            padding: 16px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid #eee; 
            z-index: 20; 
        }

        .logo { 
            font-weight: 800; 
            color: var(--brand); 
            font-size: 18px; 
            display: flex; 
            gap: 5px; 
            align-items: center; 
            cursor: pointer; 
            user-select: none;
        }

        .secure-badge { 
            font-size: 11px; 
            background: #DDEBF6; 
            color: #4496F5; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-weight: 700; 
            cursor: pointer; 
        }

        .watch-bar { 
            background: #2D3436; 
            color: white; 
            padding: 12px 20px; 
            font-size: 13px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            transition: background 0.3s; 
            cursor: pointer; 
        }
        
        .watch-bar.alert { 
            background: var(--danger); 
            animation: pulse-bg 1s infinite alternate; 
        }

        .watch-bar.disconnected {
			background: #576574;
			color: #ffffff !important; 
        }
		
		.watch-bar.disconnected #watch-state-text {
			opacity: 0.9;
		}

        @keyframes pulse-bg { 
            from { background: var(--danger); } 
            to { background: #D63031; } 
        }

        .pulse-dot { 
            width: 8px; 
            height: 8px; 
            background: var(--healing); 
            border-radius: 50%; 
            box-shadow: 0 0 0 rgba(0, 210, 186, 0.4); 
            animation: beat 1s infinite; 
        }

        .watch-bar.disconnected .pulse-dot {
            background: #ccc;
            animation: none;
            box-shadow: none;
        }

        @keyframes beat { 
            0% { transform: scale(1); opacity:1; } 
            100% { transform: scale(2); opacity:0; } 
        }

        /* =========================================
           3. MAIN LAYOUT & TABS
           ========================================= */
        main { 
            flex: 1; 
            overflow-y: hidden; 
            position: relative; 
        }

        /* íƒ­ ì „í™˜ ì „ìš© ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes tabFade { 
            from { opacity:0; transform:translateY(10px); } 
            to { opacity:1; transform:translateY(0); } 
        }

        .tab-content { 
            display: none; 
            padding: 20px; 
            animation: tabFade 0.3s; 
			height: 100%;
			overflow-y: auto;
			-webkit-overflow-scrolling: touch;
        }
        
        .tab-content.active { 
            display: block; 
        }

        .card { 
            background: var(--card-white); 
            border-radius: 16px; 
            padding: 22px; 
            margin-bottom: 22px; 
			margin-top: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03); 
        }

        .card-title { 
            font-size: 16px; 
            font-weight: 700; 
            margin-bottom: 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }

        .chart-wrap { 
            height: 180px; 
            width: 100%; 
            position: relative; 
        }

        .stress-summary-text {
            margin-top: 15px;
            padding: 15px;
            background: #F8F9FA;
            border-radius: 12px;
            font-size: 13px;
            color: #555;
            line-height: 1.5;
        }
        .stress-trend-badge {
            display: inline-block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--brand);
        }

        .status-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 12px; 
            margin-top: 10px; 
        }
        
        .status-item { 
            background: #F8F9FA; 
            padding: 15px; 
            border-radius: 12px; 
            text-align: center; 
        }
        
        .status-val { 
            font-size: 20px; 
            font-weight: 800; 
            display: block; 
            margin-top: 5px; 
        }

        .ai-insight-card {
            background: linear-gradient(135deg, #ffffff 0%, #F3F0FF 100%);
            border: 1px solid #E0D4FC;
            position: relative;
            overflow: hidden;
        }
        
        .ai-insight-badge {
            font-size: 11px;
            background: #6c5ce7;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: bold;
        }

        .emergency-btn-lg {
            width: 100%;
            background: #fff0f0;
            border: 2px solid var(--danger);
            color: var(--danger);
            padding: 15px;
            border-radius: 16px;
            font-weight: 800;
            font-size: 15px;
            
            margin-top: 16px; 
            margin-bottom: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.2s;
        }
        .emergency-btn-lg:active {
            background: var(--danger);
            color: white;
            transform: scale(0.98);
        }

        /* My Page Specific Styles */
        .setting-group {
            border-bottom: 1px solid #f0f0f0;
            padding: 15px 0;
        }
        .setting-group:last-child {
            border-bottom: none;
        }
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .setting-label {
            font-size: 14px;
            color: #333;
        }
        .setting-desc {
            font-size: 13px;
            color: #888;
			margin-top: 2px;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 40px;
            height: 22px;
            background: var(--toggle-off);
            border-radius: 11px;
            cursor: pointer;
            transition: 0.3s;
        }
        .toggle-switch.on {
            background: var(--toggle-on);
        }
        .toggle-knob {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }
        .toggle-switch.on .toggle-knob {
            transform: translateX(18px);
        }

        /* Ticket Wallet */
        .ticket-wallet {
		background: #2D3436; /* ë‹¤í¬ í…Œë§ˆ ìœ ì§€ */
		color: white;
		padding: 24px;
		border-radius: 20px;
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 20px;
		}

		.wallet-info {
			flex: 1;
		}

		.wallet-label {
			font-size: 13px;
			opacity: 0.8;
			margin-bottom: 4px;
		}

		.wallet-value {
			font-size: 28px;
			font-weight: 800;
		}

		.wallet-subtext {
			font-size: 11px;
			opacity: 0.5;
			margin-top: 4px;
		}

		.wallet-actions {
			display: flex;
			flex-direction: column; /* ë²„íŠ¼ì„ ì„¸ë¡œë¡œ ë°°ì¹˜í•˜ì—¬ ê°€ë…ì„± í–¥ìƒ */
			gap: 8px;
		}

		.wallet-btn {
			border: none;
			padding: 10px 16px;
			border-radius: 12px;
			font-weight: 700;
			font-size: 13px;
			cursor: pointer;
			white-space: nowrap;
			transition: 0.2s;
		}

		.wallet-btn.charge { 
			background: white; 
			color: #2D3436; 
		}

		.wallet-btn.exchange { 
			background: var(--brand); /* ë¸Œëœë“œ ì»¬ëŸ¬ ì‚¬ìš© */
			color: white; 
		}

		.wallet-btn:active {
			transform: scale(0.96);
		}

        /* =========================================
           4. CHAT, BOOKING, ADMIN, MODALS
           ========================================= */
        #tab-chat { display: none; flex-direction: column; height: 100%; padding: 0; background: #fff; position: relative; overflow-y: hidden !important; }
        #tab-chat.active { display: flex; }

        .chat-top-bar { 
			display: none; /* ìˆ˜ì •: flexì—ì„œ noneìœ¼ë¡œ ë³€ê²½ */
			position: relative;       
			height: 60px;
			padding: 0 20px;
			background: #fff; 
			border-bottom: 1px solid #eee; 
			align-items: center; 
		}

        .chat-secure-label { 
            position: absolute;       
            left: 50%;                
            transform: translateX(-50%); 
            
            display: flex; 
            align-items: center; 
            justify-content: center;
            height: 32px;
            gap: 6px; 
            color: #2E7D32; 
            font-weight: bold; 
            background: #E8F5E9; 
            padding: 0 14px; 
            border-radius: 20px;
            font-size: 12px;
            white-space: nowrap;      
        }

        .chat-top-bar button {
            display: flex;            
            align-items: center; 
            justify-content: center;
            height: 40px;             
            background: none;
            border: none;
            cursor: pointer;
        }

        .chat-reset-btn {
            border: 1px solid #eee !important; 
            background: white !important;
            border-radius: 20px;
            padding: 0 12px;
            height: 32px !important;  
            font-size: 11px;
            color: #666;
            gap: 4px;
        }

        .chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .msg { max-width: 80%; padding: 12px 16px; border-radius: 16px; font-size: 14px; line-height: 1.5; word-break: keep-all; }
        .msg.ai { background: #F1F3F5; align-self: flex-start; border-top-left-radius: 2px; }
        .msg.user { background: var(--brand); color: white; align-self: flex-end; border-top-right-radius: 2px; }
        .msg.expert { background: #E3FAFC; color: #0C8599; border: 1px solid #99E9F2; align-self: flex-start; border-top-left-radius: 2px; }
        .chat-input-box { padding: 15px; border-top: 1px solid #eee; display: none; gap: 10px; background: #fff; }
        .chat-input-box input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
        .chat-input-box button { background: var(--brand); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-weight: bold; }

        #chat-sidebar { position: absolute; top: 0; left: 0; width: 280px; height: 100%; background: #fff; z-index: 100; transform: translateX(-100%); transition: 0.3s; box-shadow: 2px 0 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        #chat-sidebar.open { transform: translateX(0); }
        .sidebar-header { padding: 20px; font-weight: bold; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .history-list { flex: 1; overflow-y: auto; padding: 10px; }
        .history-item { padding: 12px; border-radius: 8px; margin-bottom: 5px; cursor: pointer; font-size: 13px; color: #333; }
        .history-item:hover { background: #f5f5f5; }

        #chat-mode-selector { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 50; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .mode-card { width: 80%; padding: 20px; border-radius: 16px; margin-bottom: 15px; cursor: pointer; border: 2px solid transparent; box-shadow: 0 4px 15px rgba(0,0,0,0.05); background: white; text-align: center; transition: 0.2s; }
        .mode-card.empathy { border-color: #FFB8B8; }
        .mode-card.solution { border-color: #74C0FC; }
        
        #booking-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #F5F7FA; z-index: 150; display: none; flex-direction: column; }
        #booking-view.active { display: flex; animation: fadeIn 0.3s; }
        .booking-header { background: white; padding: 20px; font-weight: bold; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .booking-content { flex: 1; overflow-y: auto; padding: 20px; }
        .expert-card { background: white; border-radius: 16px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 15px; }
        .expert-profile { display: flex; gap: 15px; align-items: center; }
        .expert-avatar { width: 50px; height: 50px; background: #E3F2FD; color: var(--brand); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold; }
        .expert-tags { display: flex; gap: 5px; margin-top: 5px; }
        .expert-tag { font-size: 10px; padding: 3px 8px; background: #F0F0F0; border-radius: 4px; color: #555; }
        .time-slots { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .time-btn { border: 1px solid #ddd; background: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; cursor: pointer; white-space: nowrap; color: #333; }
        .time-btn.selected { background: var(--brand); color: white; border-color: var(--brand); }
        .book-action-btn { background: #333; color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 5px; }

        /* [ê´€ë¦¬ì í™”ë©´ ì• ë‹ˆë©”ì´ì…˜] */
        #admin-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #F4F6F8; z-index: 200; display: none; flex-direction: column; }
        #admin-view.active { display: flex; animation: adminFade 0.3s ease-out; }
        
        @keyframes adminFade {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .admin-header { background: var(--admin); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        .admin-kpi {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 12px;
			padding: 20px;
		}
		.kpi-card {
			min-width: 0 !important; /* ê·¸ë¦¬ë“œ ëŒ€ì‘ */
			border-top: 4px solid var(--admin);
		}
		.kpi-value.danger { color: var(--danger); }
		.kpi-value.safe { color: var(--healing); }

		.risk-radar-card {
			background: #FFF5F5;
			border: 1px solid #FFE3E3;
		}
		.risk-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 10px 0;
			border-bottom: 1px solid #FFE3E3;
		}
		.risk-item:last-child { border-bottom: none; }
		.risk-tag {
			font-size: 10px;
			padding: 2px 6px;
			border-radius: 4px;
			font-weight: bold;
		}
		.tag-critical { background: var(--danger); color: white; }
		.tag-warning { background: #FF9F43; color: white; }

		.admin-action-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 10px;
			margin-top: 10px;
		}
		.btn-admin-task {
			background: white;
			border: 1px solid #ddd;
			padding: 12px;
			border-radius: 10px;
			font-size: 12px;
			font-weight: bold;
			cursor: pointer;
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 5px;
		}
		.btn-admin-task:hover { background: #f8f9fa; border-color: var(--admin); }
        .action-item { background: #FFF3CD; border-left: 4px solid #FFC107; padding: 15px; margin-bottom: 10px; border-radius: 4px; font-size: 13px; line-height: 1.4; }
        
        #breathing-guide { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 300; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; }
        #breathing-guide.active { display: flex; animation: fadeIn 0.5s; }
        .breath-circle { width: 90px; height: 90px; background: var(--healing); border-radius: 50%; box-shadow: 0 0 30px var(--healing); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; text-align: center; margin-bottom: 40px; transition: all 4s ease-in-out; }
        
        .breath-text {font-size: 24px; font-weight: bold; margin-bottom: 40px; transition: opacity 0.3s;}
		
        #emergency-popup { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; background: #fff; padding: 25px; border-radius: 20px; border: 3px solid var(--danger); text-align: center; box-shadow: 0 10px 50px rgba(255, 107, 107, 0.4); z-index: 400; display: none; }
        #emergency-popup.show { display: block; animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(-50%, -50%) rotate(0deg); } 25% { transform: translate(-52%, -50%) rotate(-5deg); } 75% { transform: translate(-48%, -50%) rotate(5deg); } 100% { transform: translate(-50%, -50%) rotate(0deg); } }

        nav { background: var(--card-white); border-top: 1px solid #eee; padding: 10px 0 20px 0; display: flex; justify-content: space-around; z-index: 20; }
        .nav-btn { background: none; border: none; color: #aaa; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; }
        .nav-btn.active { color: var(--brand); font-weight: 700; }
        .nav-btn svg { width: 24px; height: 24px; fill: currentColor; }
        
        .alert-overlay { position: absolute; bottom: 80px; left: 20px; right: 20px; background: rgba(255,255,255,0.95); backdrop-filter: blur(5px); padding: 20px; border-radius: 20px; border: 2px solid var(--danger); box-shadow: 0 10px 40px rgba(0,0,0,0.2); display: none; z-index: 50; }
        .alert-overlay.show { display: block; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 100; }

        .new-privacy-card {
            background: white;
            width: 85%;
            max-width: 320px;
            padding: 40px 25px;
            border-radius: 30px; 
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            position: relative;
        }

        .p-title {
            color: var(--brand); 
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .p-desc {
            font-size: 14px;
            color: #333;
            margin-bottom: 30px;
            line-height: 1.4;
        }

        .p-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
            text-align: left;
        }

        .p-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            color: #333;
            letter-spacing: -0.5px;
        }

        .p-icon {
            min-width: 24px;
            height: 24px;
            background: #E3F2FD; 
            color: var(--brand); 
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .p-footer {
            font-size: 13px;
            color: #999;
            margin-bottom: 25px;
        }

        .p-btn {
            width: 100%;
            padding: 15px;
            background: var(--brand);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }
        .p-btn:active {
            transform: scale(0.98);
            background: #3378c9;
        }
		/* [ìƒ‰ê° ìˆ˜ì •] í¬ì¸íŠ¸ ë°” ë°°ê²½ ë° í…Œë‘ë¦¬ë¥¼ ë¸Œëœë“œ ë¸”ë£¨ í†¤ìœ¼ë¡œ ë³€ê²½ */
		#point-bar { 
			background: var(--brand-sub); padding: 10px 20px; font-size: 14px; 
			display: flex; justify-content: space-between; align-items: center; 
			border-bottom: 1px solid #DDEBF6; z-index: 25; 
		}
		.mood-container { display: flex; justify-content: space-between; gap: 8px; margin-top: 10px; }
		.mood-btn { 
			background: #f1f3f5; border: none; font-size: 26px; padding: 12px; 
			border-radius: 14px; cursor: pointer; transition: 0.2s; flex: 1; 
		}
		.mood-btn.selected { background: var(--brand-sub); border: 2px solid var(--brand); }
		#mood-status-msg { margin-top:15px; font-size:14px; color:var(--brand); text-align:center; font-weight:600; }
		.booking-step-label {
			font-size: 12px;
			font-weight: bold;
			color: #888;
			margin-bottom: 8px;
			display: block;
		}

		.method-grid {
			display: grid;
			grid-template-columns: 1fr 1fr 1fr; /* 3ë¶„í•  */
			gap: 8px;
			margin-bottom: 20px;
		}

		.method-btn {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			gap: 5px;
			padding: 12px;
			border: 1px solid #eee;
			background: #f8f9fa;
			border-radius: 10px;
			cursor: pointer;
			transition: 0.2s;
		}

		.method-btn.selected {
			background: var(--brand-sub);
			border: 1px solid var(--brand);
			color: var(--brand);
			font-weight: bold;
		}

		.ticket-required-badge {
			font-size: 10px;
			padding: 2px 6px;
			border-radius: 4px;
			margin-top: 2px;
			background: #eee;
			color: #666;
		}

		.method-btn.selected .ticket-required-badge {
			background: var(--brand);
			color: white;
		}
		
		.pay-tab-group {
		display: flex;
		background: #f1f3f5;
		padding: 4px;
		border-radius: 12px;
		margin-bottom: 20px;
		}

		.pay-tab {
			flex: 1;
			padding: 10px;
			border: none;
			border-radius: 10px;
			background: transparent;
			color: #888;
			font-weight: bold;
			font-size: 13px;
			cursor: pointer;
			transition: 0.2s;
		}

		.pay-tab.active {
			background: white;
			color: var(--brand);
			box-shadow: 0 2px 5px rgba(0,0,0,0.05);
		}

		.pay-product-list {
			display: flex;
			flex-direction: column;
			gap: 12px;
		}

		.pay-product {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 16px;
			border: 1px solid #eee;
			border-radius: 12px;
			background: white;
			cursor: pointer;
			transition: 0.2s;
		}

		.pay-product:active {
			transform: scale(0.98);
			background: #f8f9fa;
			border-color: var(--brand);
		}

		.pay-badge {
			font-size: 10px;
			background: #FF6B6B;
			color: white;
			padding: 2px 6px;
			border-radius: 4px;
			margin-left: 5px;
			vertical-align: middle;
		}
		
		#pg-layer {
			position: absolute; top: 0; left: 0; width: 100%; height: 100%;
			background: #F2F4F6; z-index: 500; display: none; flex-direction: column;
			animation: slideUp 0.3s cubic-bezier(0.25, 1, 0.5, 1);
		}

		.pg-header {
			background: white; padding: 15px 20px; display: flex; align-items: center;
			border-bottom: 1px solid #eee;
		}

		.pg-content { flex: 1; overflow-y: auto; padding: 20px; }

		.pg-section-title {
			font-size: 14px; font-weight: bold; color: #333; margin-bottom: 10px; margin-top: 20px;
		}
		.pg-section-title:first-child { margin-top: 0; }

		.pg-card {
			background: white; border-radius: 12px; padding: 20px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.03); margin-bottom: 10px;
		}

		.pg-summary-row {
			display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; color: #666;
		}
		.pg-summary-row.total {
			margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;
			color: #333; font-weight: 800; font-size: 18px; align-items: center;
		}
		.pg-summary-row.total .price { color: var(--brand); }

		/* ê²°ì œ ìˆ˜ë‹¨ ê·¸ë¦¬ë“œ */
		.pg-method-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
		.pg-method-btn {
			border: 1px solid #ddd; background: white; border-radius: 8px;
			padding: 15px 5px; display: flex; flex-direction: column; align-items: center; gap: 6px;
			cursor: pointer; transition: 0.2s;
		}
		.pg-method-btn.selected {
			border-color: var(--brand); background: #E3F2FD; color: var(--brand); font-weight: bold;
		}
		.pg-icon { font-size: 20px; }

		/* ì•½ê´€ ë™ì˜ */
		.pg-terms { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #555; cursor: pointer; }
		.pg-checkbox {
			width: 20px; height: 20px; border: 2px solid #ddd; border-radius: 50%;
			display: flex; align-items: center; justify-content: center; color: white; transition: 0.2s;
		}
		.pg-checkbox.checked { background: var(--brand); border-color: var(--brand); }

		/* í•˜ë‹¨ ê²°ì œ ë²„íŠ¼ */
		.pg-footer {
			background: white; padding: 20px; border-top: 1px solid #eee;
			padding-bottom: 30px; /* ì•„ì´í° í•˜ë‹¨ ë°” ëŒ€ì‘ */
		}
		.pg-pay-btn {
			width: 100%; padding: 16px; border: none; border-radius: 12px;
			background: var(--brand); color: white; font-size: 16px; font-weight: 800;
			cursor: pointer; transition: 0.2s;
		}
		.pg-pay-btn:disabled { background: #ccc; cursor: not-allowed; }
		
		/* [ì‹ ê·œ] ëŒ€ë‚˜ë¬´ ìˆ²(ì»¤ë®¤ë‹ˆí‹°) ìŠ¤íƒ€ì¼ */
		#community-view {
			position: absolute; top: 0; left: 0; width: 100%; height: 100%;
			background: #F0F2F5; z-index: 160; display: none; flex-direction: column;
		}

		.comm-header {
			background: white; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between;
			border-bottom: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.03);
		}

		.comm-feed { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 80px; }

		.post-card {
			background: white; border-radius: 16px; padding: 20px; margin-bottom: 15px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.02); position: relative;
		}

		.post-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
		.post-avatar {
			width: 32px; height: 32px; background: #E3F2FD; color: var(--brand);
			border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px;
		}
		.post-nick { font-size: 13px; font-weight: bold; color: #333; }
		.post-time { font-size: 11px; color: #999; margin-left: auto; }

		.post-body { font-size: 14px; line-height: 1.6; color: #444; white-space: pre-wrap; margin-bottom: 15px; }

		.post-footer { display: flex; gap: 10px; border-top: 1px solid #f5f5f5; padding-top: 12px; }
		.reaction-btn {
			background: #f8f9fa; border: none; padding: 6px 12px; border-radius: 20px;
			font-size: 12px; color: #555; cursor: pointer; display: flex; align-items: center; gap: 4px;
			transition: 0.2s;
		}
		.reaction-btn:hover { background: #e9ecef; }
		.reaction-btn.active { background: #E3F2FD; color: var(--brand); font-weight: bold; }

		/* ê¸€ì“°ê¸° í”Œë¡œíŒ… ë²„íŠ¼ (FAB) */
		.fab-write {
			position: absolute; bottom: 30px; right: 20px;
			width: 56px; height: 56px; background: var(--brand); color: white;
			border-radius: 50%; box-shadow: 0 4px 15px rgba(68, 150, 245, 0.4);
			display: flex; align-items: center; justify-content: center;
			font-size: 24px; cursor: pointer; border: none; transition: transform 0.2s;
		}
		.fab-write:active { transform: scale(0.9); }
		/* [ì‹ ê·œ] ëŒ“ê¸€ ëª¨ë‹¬ ë””ìì¸ */
		#comm-comment-modal .card {
			height: 80vh; display: flex; flex-direction: column;
		}
		.comment-list {
			flex: 1; overflow-y: auto; background: #f8f9fa; margin: 10px -20px; padding: 15px 20px;
		}
		.comment-item {
			margin-bottom: 12px; font-size: 13px;
		}
		.cmt-nick { font-weight: bold; margin-bottom: 2px; display: flex; align-items: center; gap: 5px; }
		.cmt-time { font-size: 10px; color: #999; font-weight: normal; }
		.cmt-body { background: white; padding: 8px 12px; border-radius: 0 12px 12px 12px; border: 1px solid #eee; display: inline-block; max-width: 90%; line-height: 1.4; }
		.cmt-input-area {
			display: flex; gap: 8px; border-top: 1px solid #eee; padding-top: 15px;
		}
				
    </style>
</head>
<body>

<div id="app-frame">
	<div id="point-bar">
		<div id="user-tier" style="color: var(--brand); font-weight: bold;">âœ¨ Lv.1 ë§ˆìŒê¿ˆë‚˜ë¬´</div>
		<div style="font-weight: 800; color: #636E72; cursor: pointer;" onclick="window.app.debugPoints()">
			ğŸª™ <span id="user-points">0</span> P
		</div>
	</div>
    <header>
        <div class="logo" onclick="window.app.handleLogoClick()">
            <span style="color:var(--brand);">RE:COVER</span>
        </div>
        <div class="secure-badge" id="privacy-btn">ğŸ›¡ï¸ ë‚´Â ê¸°ë¡ ë³´í˜¸ì¤‘</div>
    </header>

    <div class="watch-bar" id="watch-status" onclick="window.app.toggleWatchConnection()">
        <div style="display:flex; align-items:center; gap:8px;">
            <span id="watch-name">âŒš Galaxy Watch 6</span>
            <span id="watch-state-text" style="font-size:11px; opacity:0.7;">| Sync Active</span>
        </div>
        <div style="display:flex; align-items:center; gap:8px;">
            <span id="bpm-val" style="font-weight:700;">-- bpm</span>
            <div class="pulse-dot" id="pulse-dot"></div>
        </div>
    </div>

    <main>
        <div id="tab-home" class="tab-content active">
		
			<div class="card">
				<div class="card-title">
					<span>ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€ ì–´ë–¤ê°€ìš”?</span>
					<span id="mood-reward-badge" style="font-size:12px; color:#00D2BA;">+50P ì ë¦½</span>
				</div>
				<div class="mood-container">
					<button class="mood-btn" data-mood="happy" onclick="window.app.recordMood('happy', 'ğŸ˜Š')">ğŸ˜Š</button>
					<button class="mood-btn" data-mood="calm" onclick="window.app.recordMood('calm', 'ğŸ˜Œ')">ğŸ˜Œ</button>
					<button class="mood-btn" data-mood="tired" onclick="window.app.recordMood('tired', 'ğŸ˜‘')">ğŸ˜‘</button>
					<button class="mood-btn" data-mood="sad" onclick="window.app.recordMood('sad', 'ğŸ˜¢')">ğŸ˜¢</button>
					<button class="mood-btn" data-mood="angry" onclick="window.app.recordMood('angry', 'ğŸ”¥')">ğŸ”¥</button>
				</div>
				<div id="mood-status-msg" style="display:none; margin-top:15px; font-size:14px; color:var(--brand); text-align:center; font-weight:600;">
					ë§ˆìŒì„ ê¸°ë¡í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸª™ +50P
				</div>
			</div>
            <div class="card">
                <div class="card-title">
                    <span>ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜</span>
                    <span style="font-size:11px; background:#FF6B6B; color:white; padding:2px 6px; border-radius:4px;">LIVE</span>
                </div>
                <div class="chart-wrap"><canvas id="liveChart"></canvas></div>
                <div class="stress-summary-text">
                    <span class="stress-trend-badge">ğŸ“‰ ì „ì£¼ ëŒ€ë¹„ 15% ê°ì†Œ</span><br>
                    ìµœê·¼ 3ì¼ê°„ ê¸‰ê²©í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ìŠ¤íŒŒì´í¬ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ì–´ìš”.<br> í˜„ì¬ ìƒíƒœëŠ” ë§¤ìš° ì•ˆì •ì ì´ì—ìš”.
                </div>
            </div>
            
            <div class="status-grid">
                <div class="status-item">
                    <div style="font-size:12px; color:#888;">ìˆ˜ë©´ í’ˆì§ˆ</div>
                    <span class="status-val" style="color:#636E72;">4h 12m</span>
                    <span style="font-size:10px; color:#FF6B6B;">ë¶€ì¡± âš ï¸</span>
                </div>
                <div class="status-item">
                    <div style="font-size:12px; color:#888;">í‡´ê·¼ ì˜ˆìƒ</div>
                    <span class="status-val" style="color:var(--brand);">18:30</span>
                    <span style="font-size:10px; color:#00D2BA;">ì •ì‹œ í‡´ê·¼</span>
                </div>
            </div>
			
			<div class="card" onclick="window.community.init()" style="margin-top:15px; background:linear-gradient(to right, #2E7D32, #43A047); color:white; cursor:pointer; display:flex; justify-content:space-between; align-items:center;">
				<div>
					<div style="font-weight:bold; font-size:16px; margin-bottom:4px;">ğŸ‹ ì† ì‹œì›í•œ ëŒ€ë‚˜ë¬´ ìˆ²</div>
					<div style="font-size:12px; opacity:0.9;">ì„ê¸ˆë‹˜ ê·€ëŠ” ë‹¹ë‚˜ê·€ ê·€! <br>ë™ë£Œë“¤ê³¼ ìµëª…ìœ¼ë¡œ ì†Œí†µí•´ìš”.</div>
				</div>
				<div style="font-size:32px;">ğŸ¼</div>
			</div>
			
            <div class="card" style="background: linear-gradient(135deg, #4496F5); color: white; margin-top:16px; text-align: center;">
				<div style="font-size: 40px; margin-bottom: 5px;">ğŸ’¬</div>
				<h3 style="margin:0 0 10px 0;">íšŒì‚¬ ëª¨ë¥´ê²Œ ìƒë‹´ë°›ê¸°</h3>
				<p style="font-size:14px; opacity:0.9; margin-bottom:20px;">
					í˜„ì¬ ë³´ìœ  ì¤‘ì¸ ìƒë‹´ê¶Œ<br>
					<span style="font-size:15px;">
						ë¹„ëŒ€ë©´ <b id="home-online-cnt">3</b>íšŒ / ëŒ€ë©´ <b id="home-offline-cnt">0</b>íšŒ
					</span> 
				</p>
				<div style="display:flex; gap:10px;">
					<button id="connect-human-btn" style="flex:1; background:white; color:#4496F5; border:none; padding:12px; border-radius:20px; font-weight:bold; cursor:pointer;">AI ë°”ë¡œ ìƒë‹´</button>
					<button id="btn-book-expert" style="flex:1; background:rgba(255,255,255,0.2); color:white; border:1px solid white; padding:12px; border-radius:20px; font-weight:bold; cursor:pointer;">ì „ë¬¸ê°€ ìƒë‹´ ì˜ˆì•½</button>
				</div>
			</div>
        </div>

        <div id="tab-chat" class="tab-content">
            <div id="chat-sidebar">
                <div class="sidebar-header">
                    <span>ìƒë‹´ ê¸°ë¡ (Log)</span>
                    <button onclick="window.chat.toggleSidebar()" style="border:none; background:none; font-size:20px;">Ã—</button>
                </div>
                <div class="history-list" id="history-list"></div>
                <div style="padding:15px; border-top:1px solid #eee;">
                    <button onclick="window.chat.clearHistory()" style="width:100%; padding:10px; border:1px solid #ddd; background:#fff; border-radius:8px; color:red;">ğŸ—‘ï¸ ëª¨ë“  ê¸°ë¡ ì‚­ì œ</button>
                </div>
            </div>
            <div id="chat-entry-screen" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; gap: 20px;">
				<h3 style="margin-bottom:10px;">ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”?</h3>
				<button onclick="window.chat.showAiOptions()" style="width: 80%; padding: 20px; border-radius: 16px; border: 2px solid var(--healing); background: white; cursor: pointer;">
					<div style="font-size:30px;">ğŸ¤–</div>
					<div style="font-weight:bold; font-size:16px; margin-top:10px;">AIì™€ ë°”ë¡œ ìƒë‹´í•˜ê¸°</div>
					<div style="font-size:12px; color:#888;">24ì‹œê°„ ë¬´ë£Œ ê³µê°/í•´ê²° ìƒë‹´</div>
				</button>
				<button onclick="window.booking.open()" style="width: 80%; padding: 20px; border-radius: 16px; border: 2px solid var(--brand); background: white; cursor: pointer;">
					<div style="font-size:30px;">ğŸ‘©â€âš•ï¸</div>
					<div style="font-weight:bold; font-size:16px; margin-top:10px;">ì „ë¬¸ê°€ ì˜ˆì•½í•˜ê¸°</div>
					<div style="font-size:12px; color:#888;">ìƒë‹´ê¶Œ ì‚¬ìš©í•˜ì—¬ ì‹¬ì¸µ ìƒë‹´</div>
				</button>
			</div>

			<div id="chat-mode-selector" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 50; flex-direction: column; align-items: center; justify-content: center;">
				<h3 style="margin-bottom:20px;">ì›í•˜ì‹œëŠ” ëŒ€í™” ìŠ¤íƒ€ì¼ì„ ê³¨ë¼ì£¼ì„¸ìš”</h3>
				<div class="mode-card empathy" onclick="window.chat.selectMode('empathy')">
					<div style="font-size:30px;">ğŸ§¸</div>
					<h4>ê³µê° ì¤‘ì‹¬</h4>
					<p style="font-size:12px; color:#666;">"ë§ì´ í˜ë“œì…¨êµ°ìš”" <br> ë”°ëœ»í•œ ìœ„ë¡œê°€ í•„ìš”í•´ìš”.</p>
				</div>
				<div class="mode-card solution" onclick="window.chat.selectMode('solution')">
					<div style="font-size:30px;">ğŸ§©</div>
					<h4>í•´ê²° ì¤‘ì‹¬</h4>
					<p style="font-size:12px; color:#666;">"ì´ë ‡ê²Œ í•´ë³´ì„¸ìš”" <br> ì‹¤ì§ˆì ì¸ ì¡°ì–¸ì´ í•„ìš”í•´ìš”.</p>
				</div>
				<button onclick="window.chat.backToEntry()" style="margin-top:20px; background:none; border:none; color:#888; text-decoration:underline;">ë’¤ë¡œ ê°€ê¸°</button>
			</div>
            
            <div class="chat-top-bar">
				<button onclick="window.chat.toggleSidebar()" style="font-size:20px;">â‰¡</button>
    
				<div class="chat-secure-label" id="chat-header-label">ğŸ¤– AI ìƒë‹´ (24h) Â· ìµëª… ë³´ì¥</div>
    
				<button onclick="window.chat.resetMode()" class="chat-reset-btn">
				ğŸ”„ ë‹¤ì‹œ ì„ íƒ
				</button>
			</div>

            <div class="chat-area" id="msg-container"></div>
            <div class="chat-input-box">
                <input type="text" id="input-msg" placeholder="ì˜¤ëŠ˜ ì–´ë–¤ ì¼ì´ ìˆì—ˆë‚˜ìš”?">
                <button id="send-btn">â¤</button>
            </div>
        </div>
        
        <div id="tab-stats" class="tab-content">
            <div class="card ai-insight-card">
                <div class="card-title" style="color:#6c5ce7;">
                    <span>âœ¨ AI ìœ„í´ë¦¬ ì¸ì‚¬ì´íŠ¸</span>
                    <span class="ai-insight-badge">NEW</span>
                </div>
                <p style="font-size:14px; line-height:1.6; margin-bottom:10px;">
                    ìµœê·¼ 2ì£¼ê°„ <b>íšŒë³µ ê²½í–¥</b>ì´ ë³´ì…ë‹ˆë‹¤.<br>
                    ì˜¤ëŠ˜ì€ ì ì‹¬ì‹œê°„ì— í–‡ì‚´ ë°›ìœ¼ë©° 10ë¶„ ì •ë„ ì‚°ì±… ì–´ë– ì‹ ê°€ìš”?
                </p>
                <div style="font-size:11px; color:#888; text-align:right;">Analysis by RE:COVER AI</div>
            </div>
            <div class="card">
                <div class="card-title">ìŠ¤íŠ¸ë ˆìŠ¤ ì›ì¸ ë¶„ì„</div>
                <div class="chart-wrap" style="height:220px;"><canvas id="causeChart"></canvas></div>
                <div style="margin-top:15px; font-size:11px; color:#888; background:#f8f9fa; padding:10px; border-radius:8px;">
                    * <b>ë¶„ì„ ê¸°ë°˜:</b> ì±„íŒ… í‚¤ì›Œë“œ(ê°ì •ë…¸ë™), ê·¼ë¬´ ì‹œê°„(ìœ„ì¹˜), ìˆ˜ë©´ íŒ¨í„´ ë°ì´í„° ì¢…í•©
                </div>
            </div>
            <div class="card">
                <div class="card-title">ì´ë²ˆ ë‹¬ ë§ˆìŒ ëŒë´„ í˜„í™©</div>
                <div class="status-grid">
                    <div class="status-item">
                        <div style="font-size:12px; color:#888;">AI ëŒ€í™”</div>
                        <span class="status-val" style="color:#00D2BA;">14íšŒ</span>
                        <span style="font-size:10px; color:#888;">ì–¸ì œë“  ëŒ€ê¸°ì¤‘</span>
                    </div>
                    <div class="status-item">
                        <div style="font-size:12px; color:#888;">ì „ë¬¸ê°€ ìƒë‹´</div>
                        <span class="status-val" style="color:#FF6B6B;">1íšŒ</span>
                        <span style="font-size:10px; color:#888;">ê¹Šì€ ì¹˜ìœ </span>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ì£¼ê°„ ìŠ¤íŠ¸ë ˆìŠ¤ ì¶”ì´</div>
                <div class="chart-wrap"><canvas id="weekChart"></canvas></div>
            </div>
        </div>
        
        <div id="tab-mypage" class="tab-content">
            <div style="padding:10px 0 20px 0; text-align:center;">
                <div style="width:70px; height:70px; background:#ddd; border-radius:50%; margin:0 auto 10px auto; display:flex; align-items:center; justify-content:center; font-size:30px;">ğŸ‘¤</div>
                <h2 style="margin:0 0 5px 0;">User_9982</h2>
                <p style="margin:0; font-size:13px; color:#666;">ë§ˆì¼€íŒ…ë³¸ë¶€ Â· ë§ˆì¼€íŒ… 2íŒ€</p>
            </div>

        <div class="ticket-wallet" style="align-items: center;"> <div class="wallet-info">
                <div class="wallet-label" style="opacity:0.6; font-size:12px; margin-bottom:4px;">ë‚´ ìƒë‹´ê¶Œ ì”ì•¡</div>
                
                <div style="display:flex; gap:15px; align-items: flex-end;">
                    <div>
                        <div style="font-size:28px; font-weight:800; line-height:1; margin-bottom:2px;"><span id="mypage-online">3</span>íšŒ</div>
                        <span style="font-size:11px; opacity:0.5;">ë¹„ëŒ€ë©´ (ì±„íŒ…/ì „í™”)</span>
                    </div>
                    <div style="width:1px; height:30px; background:rgba(255,255,255,0.1); margin:0 5px;"></div>
                    <div>
                        <div style="font-size:28px; font-weight:800; line-height:1; margin-bottom:2px; color:;"><span id="mypage-offline">0</span>íšŒ</div>
                        <span style="font-size:11px; opacity:0.5;">ëŒ€ë©´ (ë°©ë¬¸)</span>
                    </div>
                </div>

                <div style="margin-top:10px; font-size:11px; font-weight:bold; display:flex; align-items:center; gap:4px; opacity: 0.8;">
                    âœ¨ ì—° 3íšŒ ë¬´ë£Œ í˜œíƒ ì ìš© ì¤‘
                </div>
            </div>

            <div class="wallet-actions">
                <button class="wallet-btn charge" onclick="document.getElementById('payment-modal').style.display='flex'">+ ì¶©ì „</button>
                <button class="wallet-btn exchange" onclick="document.getElementById('exchange-modal').style.display='flex'">âœ¨ êµí™˜</button>
            </div>
        </div>

            <div class="card">
                <div class="card-title">ì„œë¹„ìŠ¤ ì„¤ì •</div>
                
                <div class="setting-group">
                    <div class="setting-row">
                        <div>
                            <div class="setting-label">ì›¨ì–´ëŸ¬ë¸” ì—°ë™</div>
                            <div class="setting-desc">ê°¤ëŸ­ì‹œ ì›Œì¹˜ ì‹¬ë°•ìˆ˜ ë°ì´í„° ë™ê¸°í™”</div>
                        </div>
                        <div class="toggle-switch on" id="toggle-watch" onclick="window.app.toggleSetting(this, 'watch')">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-row">
                        <div>
                            <div class="setting-label">ì•Œë¦¼ ì„¤ì •</div>
                            <div class="setting-desc">ìœ„ê¸° ê°ì§€ ë° ìƒë‹´ ì˜ˆì•½ ì•Œë¦¼</div>
                        </div>
                        <div class="toggle-switch on" id="toggle-noti" onclick="window.app.toggleSetting(this, 'noti')">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">ë°ì´í„° ë° ë³´ì•ˆ</div>
                
                <div class="setting-group">
                    <div class="setting-row">
                        <div>
                            <div class="setting-label">ê°œì¸ ë§ì¶¤ ë¶„ì„</div>
                            <div class="setting-desc">AI ë¦¬í¬íŠ¸ ìƒì„±ì„ ìœ„í•œ ë°ì´í„° í™œìš©</div>
                        </div>
                        <div class="toggle-switch on" id="toggle-data-personal" onclick="window.app.toggleSetting(this, 'personal')">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-row">
                        <div>
                            <div class="setting-label">ì¡°ì§ í†µê³„ ì œê³µ</div>
                            <div class="setting-desc">ìµëª…í™”ëœ ë¶€ì„œ ìŠ¤íŠ¸ë ˆìŠ¤ í†µê³„ ì œê³µ</div>
                        </div>
                        <div class="toggle-switch on" id="toggle-data-org" onclick="window.app.toggleSetting(this, 'org')">
                            <div class="toggle-knob"></div>
                        </div>
                    </div>
                </div>

                <div class="setting-group">
                    <div style="font-size:13px; color:#555; background:#f8f9fa; padding:12px; border-radius:8px; line-height:1.4;">
                        ğŸ”’ <b>ë³´ì•ˆ ì •ì±…:</b> ëª¨ë“  ìƒë‹´ ë‚´ìš©ì€ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë˜ì§€ ì•Šìœ¼ë©°, ì‚¬ë‚´ ì„œë²„ì™€ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬ëœ í´ë¼ìš°ë“œì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
                    </div>
                </div>
                
                <button onclick="window.chat.clearHistory()" style="width:100%; padding:12px; margin-top:10px; background:#fff; border:1px solid #ddd; color:#FF6B6B; border-radius:8px; font-weight:bold; cursor:pointer;">
                    ğŸ—‘ï¸ ëª¨ë“  ìƒë‹´ ê¸°ë¡ ì‚­ì œ
                </button>
            </div>

            <div style="margin-top:30px; text-align:center;">
                <button onclick="alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.'); window.location.reload();" style="background:none; border:none; color:#999; text-decoration:underline; cursor:pointer; margin-bottom:20px;">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </main>

    <div class="modal-bg" id="payment-modal" onclick="this.style.display='none'">
        <div class="card" style="width:90%; max-width:360px; padding:25px;" onclick="event.stopPropagation()">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0;">ìƒë‹´ê¶Œ ìŠ¤í† ì–´</h3>
                <button onclick="document.getElementById('payment-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">Ã—</button>
            </div>

            <div class="pay-tab-group">
                <button class="pay-tab active" onclick="window.payment.switchTab('online')" id="tab-pay-online">ë¹„ëŒ€ë©´ (ì±„íŒ…/ì „í™”)</button>
                <button class="pay-tab" onclick="window.payment.switchTab('offline')" id="tab-pay-offline">ëŒ€ë©´ (ì„¼í„° ë°©ë¬¸)</button>
            </div>

            <div id="pay-view-online" class="pay-product-list">
                <div class="pay-product" onclick="window.pg.open('online', 1, 30000, 'ë¹„ëŒ€ë©´ ìƒë‹´ 1íšŒê¶Œ')">
                    <div>
                        <div style="font-weight:bold; margin-bottom:4px;">ğŸ’¬ ë¹„ëŒ€ë©´ 1íšŒê¶Œ</div>
                        <div style="font-size:12px; color:#888;">ê°€ë³ê²Œ ì‹œì‘í•˜ëŠ” ìƒë‹´</div>
                    </div>
                    <div style="text-align:right;"><div style="font-weight:bold; color:var(--brand);">30,000ì›</div></div>
                </div>
                <div class="pay-product" style="border:1px solid #b2d4ff; background:#f0f7ff;" onclick="window.pg.open('online', 3, 85000, 'ë¹„ëŒ€ë©´ ìƒë‹´ 3íšŒê¶Œ')">
                    <div>
                        <div style="font-weight:bold; margin-bottom:4px; color:#0056b3;">ğŸ’¬ ë¹„ëŒ€ë©´ 3íšŒê¶Œ <span class="pay-badge">BEST</span></div>
                        <div style="font-size:12px; color:#555;">ê¾¸ì¤€í•œ ë§ˆìŒ ê´€ë¦¬</div>
                    </div>
                    <div style="text-align:right;">
                        <div style="text-decoration:line-through; font-size:11px; color:#aaa;">90,000</div>
                        <div style="font-weight:bold; color:var(--brand);">85,000ì›</div>
                    </div>
                </div>
            </div>

            <div id="pay-view-offline" class="pay-product-list" style="display:none;">
                <div class="pay-product" onclick="window.pg.open('offline', 1, 60000, 'ëŒ€ë©´ ìƒë‹´ 1íšŒê¶Œ')">
                    <div>
                        <div style="font-weight:bold; margin-bottom:4px;">â˜• ëŒ€ë©´ 1íšŒê¶Œ</div>
                        <div style="font-size:12px; color:#888;">ì „ë¬¸ê°€ì™€ ì§ì ‘ ë§Œë‚¨</div>
                    </div>
                    <div style="text-align:right;"><div style="font-weight:bold; color:#333;">60,000ì›</div></div>
                </div>
                <div class="pay-product" style="border:1px solid #ffd8a8; background:#fff9db;" onclick="window.pg.open('offline', 3, 170000, 'ëŒ€ë©´ ìƒë‹´ 3íšŒê¶Œ')">
                    <div>
                        <div style="font-weight:bold; margin-bottom:4px; color:#d9480f;">â˜• ëŒ€ë©´ 3íšŒê¶Œ <span class="pay-badge" style="background:#fd7e14;">1ë§Œì› í• ì¸</span></div>
                        <div style="font-size:12px; color:#666;">ì‹¬ì¸µ ì‹¬ë¦¬ ì¹˜ìœ </div>
                    </div>
                    <div style="text-align:right;">
                        <div style="text-decoration:line-through; font-size:11px; color:#aaa;">180,000</div>
                        <div style="font-weight:bold; color:#d9480f;">170,000ì›</div>
                    </div>
                </div>
            </div>
            <div style="margin-top:20px; font-size:11px; color:#999; text-align:center;">
                ìœ„ ìƒí’ˆ ì„ íƒ ì‹œ ê²°ì œ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <div class="modal-bg" id="login-modal" onclick="document.getElementById('login-modal').style.display='none'">
        <div class="card" style="width:80%; max-width:300px; text-align:center; padding:30px 20px;" onclick="event.stopPropagation()">
            <div style="font-size:30px; margin-bottom:15px; color:var(--admin);">ğŸ”</div>
            <h3 style="margin:0 0 10px 0; color:var(--admin);">Admin Access</h3>
            <p style="font-size:12px; color:#999; margin-bottom:20px;">ì¸ì‚¬ ê´€ë¦¬ì ì „ìš© ë©”ë‰´ì…ë‹ˆë‹¤.</p>
            <input type="password" id="admin-pw-input" placeholder="Passcode" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; text-align:center; font-size:16px; margin-bottom:15px; outline:none;">
            <button onclick="window.app.checkAdminPw()" style="width:100%; padding:12px; background:var(--admin); color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer;">Enter</button>
        </div>
    </div>

    <div id="booking-view">
        <div class="booking-header">
            <span>ğŸ“… ì „ë¬¸ê°€ ìƒë‹´ ì˜ˆì•½</span>
            <button onclick="window.booking.close()" style="border:none; background:none; font-size:18px; cursor:pointer;">âœ•</button>
        </div>
        <div class="booking-content">
            <div class="expert-card" id="expert-card-1">
                <div class="expert-profile">
                    <div class="expert-avatar">K</div>
                    <div class="expert-info">
                        <h4>ê¹€ë§ˆìŒ ìƒë‹´ì‚¬</h4>
                        <p>ì„ìƒì‹¬ë¦¬ì „ë¬¸ê°€ 1ê¸‰ | ê²½ë ¥ 12ë…„</p>
                        <div class="expert-tags">
                            <span class="expert-tag">#ìš°ìš¸</span>
                            <span class="expert-tag">#ì§ë¬´ìŠ¤íŠ¸ë ˆìŠ¤</span>
                        </div>
                    </div>
                </div>
                
                <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">

                <span class="booking-step-label">STEP 1. ìƒë‹´ ë°©ì‹ ì„ íƒ</span>
                <div class="method-grid">
                    <div class="method-btn selected" onclick="window.booking.selectMethod(this, 'chat')">
                        <span style="font-size:18px;">ğŸ’¬</span>
                        <span>ì±„íŒ…</span>
                        <span class="ticket-required-badge">ë¹„ëŒ€ë©´ê¶Œ</span>
                    </div>
                    <div class="method-btn" onclick="window.booking.selectMethod(this, 'call')">
                        <span style="font-size:18px;">ğŸ“</span>
                        <span>ì „í™”</span>
                        <span class="ticket-required-badge">ë¹„ëŒ€ë©´ê¶Œ</span>
                    </div>
                    <div class="method-btn" onclick="window.booking.selectMethod(this, 'meet')">
                        <span style="font-size:18px;">â˜•</span>
                        <span>ëŒ€ë©´</span>
                        <span class="ticket-required-badge">ëŒ€ë©´ê¶Œ</span>
                    </div>
                </div>

                <span class="booking-step-label">STEP 2. ê°€ëŠ¥í•œ ì‹œê°„ ì„ íƒ</span>
                <div class="time-slots" id="slots-expert-1">
                    <button class="time-btn" onclick="window.booking.selectTime(this)">ì˜¤ëŠ˜ 14:00</button>
                    <button class="time-btn" onclick="window.booking.selectTime(this)">ì˜¤ëŠ˜ 16:00</button>
                    <button class="time-btn" onclick="window.booking.selectTime(this)">ë‚´ì¼ 10:00</button>
                    <button class="time-btn" onclick="window.booking.selectTime(this)">ë‚´ì¼ 13:00</button>
                </div>

                <button class="book-action-btn" onclick="window.booking.confirm(this)">ì˜ˆì•½ ì™„ë£Œ (ìƒë‹´ê¶Œ ì°¨ê°)</button>
            </div>

            <div class="expert-card" id="expert-card-2">
                <div class="expert-profile">
                    <div class="expert-avatar" style="background:#E8F5E9; color:#2E7D32;">L</div>
                    <div class="expert-info">
                        <h4>ì´í•´ê²° ì½”ì¹˜</h4>
                        <p>ê¸°ì—… ì½”ì¹­ ì „ë¬¸ê°€ | ê²½ë ¥ 8ë…„</p>
                        <div class="expert-tags">
                            <span class="expert-tag">#ì¸ê°„ê´€ê³„</span>
                            <span class="expert-tag">#ì»¤ë¦¬ì–´</span>
                        </div>
                    </div>
                </div>

                <hr style="border:0; border-top:1px solid #eee; margin:15px 0;">

                <span class="booking-step-label">STEP 1. ìƒë‹´ ë°©ì‹ ì„ íƒ</span>
                <div class="method-grid">
                    <div class="method-btn selected" onclick="window.booking.selectMethod(this, 'chat')">
                        <span style="font-size:18px;">ğŸ’¬</span>
                        <span>ì±„íŒ…</span>
                        <span class="ticket-required-badge">ë¹„ëŒ€ë©´ê¶Œ</span>
                    </div>
                    <div class="method-btn" onclick="window.booking.selectMethod(this, 'call')">
                        <span style="font-size:18px;">ğŸ“</span>
                        <span>ì „í™”</span>
                        <span class="ticket-required-badge">ë¹„ëŒ€ë©´ê¶Œ</span>
                    </div>
                    <div class="method-btn" onclick="window.booking.selectMethod(this, 'meet')">
                        <span style="font-size:18px;">â˜•</span>
                        <span>ëŒ€ë©´</span>
                        <span class="ticket-required-badge">ëŒ€ë©´ê¶Œ</span>
                    </div>
                </div>

                <span class="booking-step-label">STEP 2. ê°€ëŠ¥í•œ ì‹œê°„ ì„ íƒ</span>
                <div class="time-slots" id="slots-expert-2">
                    <button class="time-btn" onclick="window.booking.selectTime(this)">ì˜¤ëŠ˜ 19:00</button>
                    <button class="time-btn" onclick="window.booking.selectTime(this)">ë‚´ì¼ 11:00</button>
                    <button class="time-btn" onclick="window.booking.selectTime(this)">ë‚´ì¼ 15:00</button>
                </div>

                <button class="book-action-btn" onclick="window.booking.confirm(this)">ì˜ˆì•½ ì™„ë£Œ (ìƒë‹´ê¶Œ ì°¨ê°)</button>
            </div>
        </div>
    </div>

    <div id="emergency-popup">
        <div style="font-size:40px; margin-bottom:10px;">ğŸš¨</div>
        <h3 style="color:var(--danger); margin:0;">ê¸´ê¸‰ ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?</h3>
        <p style="font-size:13px; color:#666; margin:10px 0 20px 0;">ë§ì”€í•˜ì‹  ë‚´ìš©ì—ì„œ ìœ„í—˜ ì‹ í˜¸ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.<br>í˜¼ì í˜ë“¤ì–´í•˜ì§€ ë§ˆì„¸ìš”.</p>
        <button onclick="window.chat.connectExpertDirect();" style="width:100%; padding:12px; background:#2D3436; color:white; border:none; border-radius:10px; font-weight:bold; margin-bottom:10px;">ğŸ‘©â€âš•ï¸ ì „ë¬¸ê°€ í•«ë¼ì¸ ì¦‰ì‹œ ì—°ê²°</button>
        <button onclick="window.app.startBreathing(); document.getElementById('emergency-popup').classList.remove('show');" style="width:100%; padding:12px; background:var(--healing); color:white; border:none; border-radius:10px; font-weight:bold; margin-bottom:10px;">ğŸƒ í˜¸í¡ë²•ìœ¼ë¡œ ì§„ì •í•˜ê¸°</button>
        <a href="tel:109" style="display:block; width:100%; padding:12px; background:var(--danger); color:white; border:none; border-radius:10px; font-weight:bold; text-decoration:none; box-sizing:border-box;">ğŸ“ 109 ìì‚´ì˜ˆë°© ìƒë‹´ì „í™”</a>
        <button onclick="document.getElementById('emergency-popup').classList.remove('show')" style="margin-top:15px; background:none; border:none; color:#999; text-decoration:underline;">ë‹«ê¸°</button>
    </div>

    <div id="breathing-guide">
        <div class="breath-text" id="breath-inst">ì¤€ë¹„í•˜ì„¸ìš”...</div>
        <div class="breath-circle" id="breath-circle">Start</div>
        <div class="breath-sub">4-7-8 í˜¸í¡ë²• (ìŒì„± ê°€ì´ë“œ ì§€ì›)</div>
        <button onclick="window.app.stopBreathing()" style="margin-top:40px; background:transparent; border:1px solid white; color:white; padding:10px 30px; border-radius:20px;">ì¢…ë£Œí•˜ê¸°</button>
    </div>

    <div id="admin-view">
		<div class="admin-header">
			<div style="display:flex; align-items:center; gap:10px;">
				<span style="font-size:20px;">ğŸ¢</span>
				<div style="font-weight:bold;">Enterprise Admin <span style="font-weight:normal; font-size:12px; opacity:0.7;">| HR Mode</span></div>
			</div>
			<button onclick="window.app.toggleAdmin(false)" style="background:none; border:1px solid rgba(255,255,255,0.3); color:white; padding:5px 12px; border-radius:20px; font-size:12px; cursor:pointer;">Dashboard Exit</button>
		</div>
		
		<div style="flex:1; overflow-y:auto; padding:20px;">
			<div style="font-size:16px; font-weight:bold; margin-bottom:15px; color:#2C3E50;">í˜„í™© ëŒ€ì‹œë³´ë“œ</div>
			<div class="admin-kpi" style="padding:0; margin-bottom:20px;">
				<div class="kpi-card">
					<div style="font-size:11px; color:#888;">í‰ê·  ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜</div>
					<div class="kpi-value danger">78.2 <span style="font-size:12px;">â–² 4.1</span></div>
				</div>
				<div class="kpi-card">
					<div style="font-size:11px; color:#888;">ë²ˆì•„ì›ƒ ìœ„í—˜êµ°</div>
					<div class="kpi-value">14% <span style="font-size:12px; font-weight:normal; color:#888;">(28ëª…)</span></div>
				</div>
				<div class="kpi-card">
					<div style="font-size:11px; color:#888;">AI ìƒë‹´ í™œì„±ë„</div>
					<div class="kpi-value safe">92% <span style="font-size:12px;">â–² 12%</span></div>
				</div>
				<div class="kpi-card">
					<div style="font-size:11px; color:#888;">ìµëª… ë³´ì¥ ì‹ ë¢°ë„</div>
					<div class="kpi-value">98.5ì </div>
				</div>
			</div>

			<div class="card">
				<div class="card-title">
					<span>íŒ€ë³„ ìŠ¤íŠ¸ë ˆìŠ¤ ë¹„êµ (í‰ê· /ìµœê³ )</span>
					<span style="font-size:11px; color:#888; font-weight:normal;">ë‹¨ìœ„: Index</span>
				</div>
				<div class="chart-wrap" style="height:250px;"><canvas id="adminTeamChart"></canvas></div>
			</div>

			<div class="card risk-radar-card">
				<div class="card-title" style="color:var(--danger);">ğŸš¨ ì‹¤ì‹œê°„ ë¦¬ìŠ¤í¬ ë ˆì´ë”</div>
				<div class="risk-item">
					<div>
						<span class="risk-tag tag-critical">CRITICAL</span>
						<span style="font-weight:bold; margin-left:5px;">ë§ˆì¼€íŒ… 2íŒ€</span>
					</div>
					<div style="font-size:12px; color:#666;">ì‹¬ë°• ë³€ì´ë„ ê¸‰ì¦ (3ëª…)</div>
				</div>
				<div class="risk-item">
					<div>
						<span class="risk-tag tag-warning">WARNING</span>
						<span style="font-weight:bold; margin-left:5px;">ê°œë°œë³¸ë¶€ BíŒ€</span>
					</div>
					<div style="font-size:12px; color:#666;">í‰ê·  ì•¼ê·¼ ì‹œê°„ 4h ì´ˆê³¼</div>
				</div>
			</div>

			<div style="font-size:16px; font-weight:bold; margin-bottom:15px; color:#2C3E50;">AI ë¶„ì„ ê¸°ë°˜ ì¶”ì²œ ì•¡ì…˜</div>
			<div class="action-item" style="margin-bottom:15px;">
				<b>[ì¸ì‚¬ì´íŠ¸]</b> ë§ˆì¼€íŒ… 2íŒ€ì˜ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¹˜ê°€ ì›”ìš”ì¼ ì˜¤ì „ 10ì‹œì— ì§‘ì¤‘ë©ë‹ˆë‹¤. ì£¼ê°„ íšŒì˜ ë°©ì‹ì„ ì„œë©´ìœ¼ë¡œ ëŒ€ì²´í•  ê²ƒì„ ì œì•ˆí•©ë‹ˆë‹¤.
			</div>
			
			<div class="admin-action-grid">
				<button class="btn-admin-task" onclick="alert('ì „ì‚¬ 1ì‹œê°„ ì¡°ê¸°í‡´ê·¼ê¶Œì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.')">
					<span style="font-size:20px;">ğŸš€</span>
					<span>ì „ì‚¬ ì¡°ê¸°í‡´ê·¼</span>
				</button>
				<button class="btn-admin-task" onclick="alert('í•´ë‹¹ íŒ€ì— ì»¤í”¼ì°¨/ê°„ì‹ ë°°ì†¡ ì˜ˆì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')">
					<span style="font-size:20px;">ğŸšš</span>
					<span>íŒ€ ê¸°í”„íŠ¸ ë°œì†¡</span>
				</button>
				<button class="btn-admin-task" onclick="alert('ì „ë¬¸ê°€ ë°©ë¬¸ ìƒë‹´ ì„¸ì…˜ì´ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.')">
					<span style="font-size:20px;">ğŸ‘©â€âš•ï¸</span>
					<span>ì°¾ì•„ê°€ëŠ” ìƒë‹´</span>
				</button>
				<button class="btn-admin-task" onclick="alert('ìµëª… í”¼ë“œë°± ìˆ˜ì§‘ ì„¤ë¬¸ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.')">
					<span style="font-size:20px;">ğŸ“</span>
					<span>ì‹¬ì¸µ ì„¤ë¬¸ ì‹œì‘</span>
				</button>
			</div>
		</div>
		<div class="modal-bg" id="team-detail-modal" onclick="this.style.display='none'">
			<div class="card" style="width:95%; max-width:400px; height:85vh; overflow-y:auto; margin-top:20px;" onclick="event.stopPropagation()">
				<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
					<div>
						<h3 id="detail-team-name" style="margin:0;">ë§ˆì¼€íŒ… 2íŒ€ ìƒì„¸ ë¦¬í¬íŠ¸</h3>
						<div style="font-size:12px; color:#888; margin-top:4px;">ë¶„ì„ ê¸°ê°„: ìµœê·¼ 30ì¼ (2025.12.07 ~ 2026.01.06)</div>
					</div>
					<button onclick="document.getElementById('team-detail-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">Ã—</button>
				</div>

				<div class="card" style="padding:15px; border:1px solid #f0f0f0; box-shadow:none;">
					<div style="font-size:14px; font-weight:bold; margin-bottom:10px;">ğŸ“‰ ì›”ê°„ ìŠ¤íŠ¸ë ˆìŠ¤ ë³€í™”</div>
					<div class="chart-wrap" style="height:150px;"><canvas id="teamTrendChart"></canvas></div>
				</div>

				<div class="status-grid" style="margin-bottom:20px;">
					<div class="status-item">
						<div style="font-size:11px; color:#888;">ì „ì›” ëŒ€ë¹„ ë³€í™”</div>
						<span class="status-val" style="color:#FF6B6B;">+12.4%</span>
						<div style="font-size:10px; color:#888;">ìƒìŠ¹ ì¶”ì„¸ âš ï¸</div>
					</div>
					<div class="status-item">
						<div style="font-size:11px; color:#888;">íŒ€ ë‚´ ìƒë‹´ ê±´ìˆ˜</div>
						<span id="detail-consult-count" class="status-val" style="color:var(--brand);">84ê±´</span>
						<div style="font-size:10px; color:#888;">ì „ì‚¬ ë¹„ì¤‘ 18.5%</div>
					</div>
				</div>

				<div class="card" style="padding:15px; border:1px solid #f0f0f0; box-shadow:none;">
					<div style="font-size:14px; font-weight:bold; margin-bottom:10px;">ğŸ’¬ ìƒë‹´ ì£¼ìš” í‚¤ì›Œë“œ Top 5</div>
					<div class="chart-wrap" style="height:180px;"><canvas id="teamKeywordChart"></canvas></div>
				</div>

				<div style="margin-top:10px;">
					<textarea placeholder="í•´ë‹¹ íŒ€ì— ëŒ€í•œ ê´€ë¦¬ì ì½”ë©˜íŠ¸ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”." style="width:100%; height:80px; padding:10px; border-radius:10px; border:1px solid #ddd; font-size:13px; outline:none;"></textarea>
					<button class="p-btn" style="margin-top:10px; padding:12px;">ë¦¬í¬íŠ¸ PDF ì €ì¥</button>
				</div>
			</div>
		</div>
	</div>

    <div class="alert-overlay" id="panic-alert">
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
            <div style="font-size:24px;">ğŸš¨</div>
            <div>
                <div style="font-weight:bold; font-size:16px; color:var(--danger);">ê³µí™© ì§•í›„ ê°ì§€ë¨</div>
                <div style="font-size:12px; color:#666;">ì‹¬ë°•ìˆ˜ê°€ ê¸‰ê²©íˆ ìƒìŠ¹í–ˆì–´ìš”.</div>
            </div>
        </div>
        <div style="display:flex; gap:10px;">
            <button onclick="window.app.startBreathing()" style="flex:1; padding:10px; background:var(--healing); color:white; border:none; border-radius:8px; font-weight:bold;">ğŸƒ í˜¸í¡ë²• ì‹œì‘</button>
            <button id="sos-btn" style="flex:1; padding:10px; background:var(--danger); color:white; border:none; border-radius:8px; font-weight:bold;">SOS ì „ë¬¸ê°€ ì—°ê²°</button>
        </div>
        <div style="text-align:center; margin-top:10px;">
            <button id="dismiss-alert-btn" style="background:none; border:none; color:#999; text-decoration:underline; font-size:12px;">ê´œì°®ì•„ìš”, ë‹«ê¸°</button>
        </div>
    </div>
    
    <nav>
        <button class="nav-btn active" data-tab="home"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>í™ˆ</span></button>
        <button class="nav-btn" data-tab="chat"><svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg><span>ìƒë‹´</span></button>
        <button class="nav-btn" data-tab="stats"><svg viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg><span>ë¦¬í¬íŠ¸</span></button>
        <button class="nav-btn" data-tab="mypage"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>ë‚´ ì •ë³´</span></button>
    </nav>
	<div id="pg-layer">
    <div class="pg-header">
        <button onclick="window.pg.close()" style="border:none; background:none; font-size:24px; margin-right:10px; cursor:pointer;">â†</button>
        <div style="font-weight:bold; font-size:16px;">ì£¼ë¬¸/ê²°ì œ</div>
    </div>
    
    <div class="pg-content">
        <div class="pg-section-title">ì£¼ë¬¸ ìƒí’ˆ ì •ë³´</div>
        <div class="pg-card">
            <div class="pg-summary-row">
                <span>ìƒí’ˆëª…</span>
                <span style="font-weight:bold; color:#333;" id="pg-prod-name">ìƒí’ˆëª…</span>
            </div>
            <div class="pg-summary-row">
                <span>ìƒí’ˆê¸ˆì•¡</span>
                <span id="pg-prod-price">0ì›</span>
            </div>
            <div class="pg-summary-row total">
                <span>ìµœì¢… ê²°ì œ ê¸ˆì•¡</span>
                <span class="price" id="pg-total-price">0ì›</span>
            </div>
        </div>

        <div class="pg-section-title">ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ</div>
        <div class="pg-card">
            <div class="pg-method-grid">
                <div class="pg-method-btn selected" onclick="window.pg.selectMethod(this)">
                    <span class="pg-icon">ğŸ’³</span>
                    <span style="font-size:12px;">ì‹ ìš©ì¹´ë“œ</span>
                </div>
                <div class="pg-method-btn" onclick="window.pg.selectMethod(this)">
                    <span class="pg-icon" style="color:#FEE500;">ğŸŸ¡</span>
                    <span style="font-size:12px;">ì¹´ì¹´ì˜¤í˜ì´</span>
                </div>
                <div class="pg-method-btn" onclick="window.pg.selectMethod(this)">
                    <span class="pg-icon" style="color:#03C75A;">ğŸŸ¢</span>
                    <span style="font-size:12px;">ë„¤ì´ë²„í˜ì´</span>
                </div>
                <div class="pg-method-btn" onclick="window.pg.selectMethod(this)">
                    <span class="pg-icon" style="color:#0064FF;">ğŸ”µ</span>
                    <span style="font-size:12px;">í† ìŠ¤í˜ì´</span>
                </div>
                <div class="pg-method-btn" onclick="window.pg.selectMethod(this)">
                    <span class="pg-icon">ğŸ“±</span>
                    <span style="font-size:12px;">íœ´ëŒ€í°ê²°ì œ</span>
                </div>
                <div class="pg-method-btn" onclick="window.pg.selectMethod(this)">
                    <span class="pg-icon">ğŸ¦</span>
                    <span style="font-size:12px;">ë¬´í†µì¥ì…ê¸ˆ</span>
                </div>
            </div>
        </div>

        <div class="pg-section-title">ì•½ê´€ ë™ì˜</div>
        <div class="pg-card">
            <div class="pg-terms" onclick="window.pg.toggleTerms()">
                <div class="pg-checkbox" id="pg-term-check">âœ”</div>
                <span>êµ¬ë§¤ ì¡°ê±´ í™•ì¸ ë° ê²°ì œ ì§„í–‰ ë™ì˜ (í•„ìˆ˜)</span>
            </div>
        </div>
    </div>

    <div class="pg-footer">
        <button id="pg-action-btn" class="pg-pay-btn" onclick="window.pg.pay()">ê²°ì œí•˜ê¸°</button>
    </div>
	</div>
	<div id="community-view">
		<div class="comm-header">
			<div style="display:flex; align-items:center; gap:8px;">
				<button onclick="document.getElementById('community-view').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">â†</button>
				<div style="font-weight:bold; font-size:18px;">ğŸ‹ ìµëª… ëŒ€ë‚˜ë¬´ ìˆ²</div>
			</div>
			<div style="font-size:12px; color:#888;">ì°¸ì—¬ì <b id="comm-user-count">142</b>ëª…</div>
		</div>

		<div class="comm-feed" id="comm-feed-list">
			</div>

		<button class="fab-write" onclick="window.community.openWrite()">âœï¸</button>
	</div>

	<div class="modal-bg" id="comm-write-modal" onclick="this.style.display='none'" style="z-index: 200;">
		<div class="card" style="width:90%; max-width:340px; padding:20px;" onclick="event.stopPropagation()">
			<h3 style="margin-top:0;">ìµëª…ìœ¼ë¡œ ë§í•˜ê¸°</h3>
			
            <textarea id="comm-input-text" placeholder="ì„ê¸ˆë‹˜ ê·€ëŠ” ë‹¹ë‚˜ê·€ ê·€!&#13;&#10;ë™ë£Œë“¤ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§ì´ë‚˜ ê³ ë¯¼ì„ í„¸ì–´ë†“ìœ¼ì„¸ìš”." 
			style="width:100%; height:120px; padding:15px; border:1px solid #ddd; border-radius:12px; resize:none; outline:none; font-family:inherit; margin-bottom:10px;"></textarea>
			
            <input type="password" id="comm-pw-input" placeholder="ë¹„ë°€ë²ˆí˜¸ (ìˆ˜ì •/ì‚­ì œìš©)" maxlength="4"
            style="width:100%; padding:12px; border:1px solid #ddd; border-radius:10px; margin-bottom:15px; outline:none; font-family:inherit;">

			<div style="display:flex; gap:10px;">
				<button onclick="document.getElementById('comm-write-modal').style.display='none'" style="flex:1; padding:12px; background:#f1f3f5; border:none; border-radius:10px; font-weight:bold; color:#666;">ì·¨ì†Œ</button>
				<button onclick="window.community.post()" style="flex:1; padding:12px; background:var(--brand); border:none; border-radius:10px; font-weight:bold; color:white;">ë“±ë¡</button>
			</div>
		</div>
	</div>
	<div class="modal-bg" id="comm-comment-modal" onclick="this.style.display='none'" style="z-index: 200;">
		<div class="card" style="width:100%; max-width:450px; border-radius: 20px 20px 0 0; margin-top: auto; margin-bottom: 0;" onclick="event.stopPropagation()">
			<div style="display:flex; justify-content:space-between; align-items:center;">
				<h3 style="margin:0;">ğŸ’¬ ëŒ“ê¸€ <span id="cmt-total-cnt" style="color:var(--brand);">0</span></h3>
				<button onclick="document.getElementById('comm-comment-modal').style.display='none'" style="border:none; background:none; font-size:24px; cursor:pointer;">Ã—</button>
			</div>
			
			<div class="comment-list" id="cmt-list-box">
				</div>

			<div class="cmt-input-area">
				<input type="text" id="cmt-input" placeholder="ë”°ëœ»í•œ í•œë§ˆë””ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”..." style="flex:1; padding:12px; border:1px solid #ddd; border-radius:20px; outline:none;">
				<button onclick="window.community.addComment()" style="background:var(--brand); color:white; border:none; width:50px; border-radius:12px; font-weight:bold; cursor:pointer;">ë“±ë¡</button>
			</div>
		</div>
	</div>
</div>

<div class="modal-bg" id="privacy-modal" onclick="this.style.display='none'">
    <div class="new-privacy-card" onclick="event.stopPropagation()">
        
        <div class="p-title">ì•ˆì‹¬í•˜ê³  ì´ìš©í•˜ì„¸ìš”</div>
        <div class="p-desc">ì–¸ì œë“  í¸íˆ ìƒë‹´í•  ìˆ˜ ìˆë„ë¡<br>ì •ë³´ê°€ ë³´í˜¸ë˜ê³  ìˆìŠµë‹ˆë‹¤</div>

        <div class="p-list">
            <div class="p-item">
                <div class="p-icon">âœ”</div>
                <span>ì˜ë£Œê¸°ë¡ìœ¼ë¡œ ë‚¨ì§€ ì•Šì•„ìš”</span>
            </div>
            <div class="p-item">
                <div class="p-icon">âœ”</div>
                <span>ì‚¬ë‚´ë§ê³¼ ë¶„ë¦¬ëœ ì„œë²„ë¥¼ ì‚¬ìš©í•´ìš”</span>
            </div>
            <div class="p-item">
                <div class="p-icon">âœ”</div>
                <span>ì¸ì‚¬íŒ€ì— ë‚´ ì •ë³´ê°€ ì œê³µë˜ì§€ ì•Šì•„ìš”</span>
            </div>
        </div>

        <div class="p-footer">
            ê¼­ í•„ìš”í•œ íŒ€ë³„ í†µê³„ë§Œ ê³µê°œë˜ì–´ ê°œì¸ì •ë³´ëŠ” ì•Œ ìˆ˜ ì—†ì–´ìš”
        </div>

        <button class="p-btn" onclick="document.getElementById('privacy-modal').style.display='none'">í™•ì¸í–ˆì–´ìš”</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, updateDoc, arrayUnion, increment, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    // â–¼â–¼â–¼ [ì—¬ê¸°!] ì•„ê¹Œ ë³µì‚¬í•œ Firebase ì„¤ì •ì„ ì´ ì•ˆì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš” â–¼â–¼â–¼
    const firebaseConfig = {
	  apiKey: "AIzaSyDgbxh4Q0uCwHglA23BZLw9CRAW2TLefEY",
	  authDomain: "re-cover-67c0d.firebaseapp.com",
	  projectId: "re-cover-67c0d",
	  storageBucket: "re-cover-67c0d.firebasestorage.app",
	  messagingSenderId: "138248073056",
	  appId: "1:138248073056:web:fa5f6aba115438bb2df805",
	  measurementId: "G-1PVC9CWHCB"
	};
    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    // 2. Firebase ì‹¤í–‰ (ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°)
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const API_KEY = "apiì˜ˆì‹œ"; // ê¸°ì¡´ AI í‚¤ ìœ ì§€

    let genAI = null; 
    let chatSession = null; 
    let isAIReady = false; 
    let onlineTickets = 3; 
	let offlineTickets = 0; 
    let chatHistory = JSON.parse(localStorage.getItem('mindChatHistory')) || [];
	
	const todayStr = new Date().toISOString().split('T')[0];
    // 1. App Controller
window.app = {
        userPoints: parseInt(localStorage.getItem('re_points')) || 0,
        // [ìˆ˜ì •] ëˆ„ì  í¬ì¸íŠ¸ ì¶”ê°€ (ê¸°ì¡´ ìœ ì €ëŠ” ë³´ìœ  í¬ì¸íŠ¸ë¥¼ ìŠ¹ê³„)
        accumulatedPoints: parseInt(localStorage.getItem('re_acc_points')) || parseInt(localStorage.getItem('re_points')) || 0,
        
        moodRecorded: localStorage.getItem('lastMoodDate') === todayStr,
        selectedMood: localStorage.getItem('lastMoodType') || null,
        currentTab: 'home', 
        alertDismissed: false,
        isWatchConnected: true, 
        logoTapCount: 0, 
        logoTapTimer: null,

        switchTab: (tabId) => {
            window.app.currentTab = tabId;
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            const targetTab = document.getElementById(`tab-${tabId}`);
            targetTab.classList.add('active');
            targetTab.scrollTop = 0;
            document.querySelector(`button[data-tab="${tabId}"]`).classList.add('active');
            
            if (tabId === 'chat') window.app.dismissAlert();
            
            window.app.updateDisplay();
        },
        
        handleLogoClick: () => {
            clearTimeout(window.app.logoTapTimer);
            window.app.logoTapCount++;
            
            if (window.app.logoTapCount >= 5) {
                document.getElementById('login-modal').style.display = 'flex';
                document.getElementById('admin-pw-input').value = '';
                document.getElementById('admin-pw-input').focus();
                window.app.logoTapCount = 0;
            } else {
                window.app.logoTapTimer = setTimeout(() => {
                    window.app.logoTapCount = 0;
                }, 500); 
            }
        },

        checkAdminPw: () => {
            const input = document.getElementById('admin-pw-input');
            if(input.value === '0000') {
                document.getElementById('login-modal').style.display = 'none';
                window.app.toggleAdmin(true);
            } else {
                alert("Passcode Incorrect");
                input.value = '';
            }
        },
        
        toggleAdmin: (show) => { 
            const view = document.getElementById('admin-view');
            if(show) {
                view.classList.add('active');
                window.admin.initChart();
            } else {
                view.classList.remove('active');
            }
        },

        toggleWatchConnection: () => {
            window.app.isWatchConnected = !window.app.isWatchConnected;
            const bar = document.getElementById('watch-status');
            const stateText = document.getElementById('watch-state-text');
            const pulse = document.getElementById('pulse-dot');
            const bpmVal = document.getElementById('bpm-val');
            const toggle = document.getElementById('toggle-watch');

            if (window.app.isWatchConnected) {
                bar.classList.remove('disconnected');
                stateText.innerText = "| Sync Active";
                pulse.style.animation = "beat 1s infinite";
                if(toggle) toggle.classList.add('on');
                alert("ê°¤ëŸ­ì‹œ ì›Œì¹˜ê°€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else {
                bar.classList.add('disconnected');
                stateText.innerText = "| Disconnected";
                pulse.style.animation = "none";
                bpmVal.innerText = "-- bpm";
                if(toggle) toggle.classList.remove('on');
                alert("ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ì‹¬ë°• ë°ì´í„° ìˆ˜ì‹ ì´ ì¤‘ì§€ë©ë‹ˆë‹¤.");
            }
        },
        
        toggleSetting: (el, type) => {
            if (type === 'watch') {
                window.app.toggleWatchConnection(); 
            } else {
                el.classList.toggle('on');
                const state = el.classList.contains('on') ? "ON" : "OFF";
                console.log(`Setting [${type}] changed to: ${state}`);
            }
        },

        triggerEmergencyCall: () => {
            if(confirm("ğŸš¨ ìœ„ê¸‰ ìƒí™©ì´ì‹ ê°€ìš”?\n119 ì•ˆì „ì‹ ê³ ì„¼í„°ë¡œ ì—°ê²°í•©ë‹ˆë‹¤.")) {
                window.location.href = "tel:119"; 
            }
        },

        startBreathing: () => {
            const guide = document.getElementById('breathing-guide');
            const circle = document.getElementById('breath-circle');
            const txt = document.getElementById('breath-inst');
            guide.classList.add('active'); 
            window.app.dismissAlert();
            
            const breathCycle = () => {
                txt.innerText = "ë“¤ì´ë§ˆì„¸ìš” (Inhale)"; 
                circle.style.transform = "scale(1.5)"; 
                circle.style.background = "#63E6BE";
                setTimeout(() => {
                    txt.innerText = "ë©ˆì¶”ì„¸ìš” (Hold)"; 
                    circle.style.transform = "scale(1.5)"; 
                    circle.style.background = "#FFD43B";
                    setTimeout(() => {
                        txt.innerText = "ë‚´ì‰¬ì„¸ìš” (Exhale)"; 
                        circle.style.transform = "scale(1)"; 
                        circle.style.background = "#74C0FC";
                    }, 7000);
                }, 4000);
            };
            breathCycle(); 
            window.breathInterval = setInterval(breathCycle, 19000);
        },
        
        stopBreathing: () => { 
            document.getElementById('breathing-guide').classList.remove('active'); 
            clearInterval(window.breathInterval); 
        },
        
        showPrivacy: () => document.getElementById('privacy-modal').style.display = 'flex',
        
        dismissAlert: () => { 
            document.getElementById('panic-alert').classList.remove('show'); 
            document.getElementById('watch-status').classList.remove('alert'); 
            window.app.alertDismissed = true; 
        },
        
        getTier: (points) => {
            if (points >= 25000) return "ğŸŒˆ Lv.6 ë§ˆìŒì˜ ë‚™ì›";
            if (points >= 10000) return "ğŸŒ² Lv.5 ë§ˆìŒì˜ ìˆ²";
            if (points >= 8000) return "ğŸŒ³ Lv.4 ë§ˆìŒì •ì›ì‚¬";
            if (points >= 5000) return "ğŸŒ¸ Lv.3 ë§ˆìŒê½ƒë‚˜ë¬´";
            if (points >= 2500) return "ğŸŒ¿ Lv.2 ë§ˆìŒìƒˆì‹¹";
            return "âœ¨ Lv.1 ë§ˆìŒê¿ˆë‚˜ë¬´";
        },
        
        // [í•µì‹¬ ìˆ˜ì •] updateDisplay
        updateDisplay: () => {
            const points = window.app.userPoints;
            const accPoints = window.app.accumulatedPoints; // ëˆ„ì  í¬ì¸íŠ¸ ê°€ì ¸ì˜¤ê¸°

            // 1. í¬ì¸íŠ¸ í‘œì‹œ
            if(document.getElementById('user-points')) document.getElementById('user-points').innerText = points.toLocaleString();
            if(document.getElementById('exchange-modal-points')) document.getElementById('exchange-modal-points').innerText = points.toLocaleString();
            
            // 2. [ìˆ˜ì •ë¨] ì¹­í˜¸ ì—…ë°ì´íŠ¸ (ëˆ„ì  í¬ì¸íŠ¸ ê¸°ì¤€)
            const currentTier = window.app.getTier(accPoints); 
            if(document.getElementById('user-tier')) document.getElementById('user-tier').innerText = currentTier;
            
            // 3. ìƒë‹´ê¶Œ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            if(document.getElementById('home-online-cnt')) document.getElementById('home-online-cnt').innerText = onlineTickets;
            if(document.getElementById('home-offline-cnt')) document.getElementById('home-offline-cnt').innerText = offlineTickets;
            if(document.getElementById('mypage-online')) document.getElementById('mypage-online').innerText = onlineTickets;
            if(document.getElementById('mypage-offline')) document.getElementById('mypage-offline').innerText = offlineTickets;
            
            // 4. ë°ì´í„° ì €ì¥
            localStorage.setItem('re_points', points);
            localStorage.setItem('re_acc_points', accPoints); // ëˆ„ì  í¬ì¸íŠ¸ë„ ì €ì¥
            localStorage.setItem('re_online_tix', onlineTickets);
            localStorage.setItem('re_offline_tix', offlineTickets);
        },

        exchangeTicket: (type, cost) => {
            if (window.app.userPoints >= cost) {
                const typeName = type === 'online' ? 'ë¹„ëŒ€ë©´' : 'ëŒ€ë©´';
                if (!confirm(`${cost.toLocaleString()}Pë¥¼ ì‚¬ìš©í•˜ì—¬ ${typeName} ìƒë‹´ê¶Œ 1íšŒë¥¼ êµí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

                window.app.userPoints -= cost; // ë³´ìœ  í¬ì¸íŠ¸ë§Œ ì°¨ê° (ëˆ„ì  í¬ì¸íŠ¸ ìœ ì§€)
                if(type === 'online') onlineTickets++;
                else offlineTickets++;
                
                window.app.updateDisplay();
                window.app.showTicketSuccessModal();
            } else {
                alert("í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ë§ˆìŒ ê¸°ë¡ì„ í†µí•´ í¬ì¸íŠ¸ë¥¼ ë” ëª¨ì•„ë³´ì„¸ìš”!");
            }
        },

        debugPoints: () => {
            const value = prompt("ì¡°ì •í•  í¬ì¸íŠ¸ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”.\n(ì˜ˆ: +1000 ë˜ëŠ” -500)", "0");
            if (value !== null) {
                const num = parseInt(value);
                if (!isNaN(num)) {
                    window.app.userPoints += num;
                    if (window.app.userPoints < 0) window.app.userPoints = 0; 
                    
                    // [ìˆ˜ì •] í¬ì¸íŠ¸ê°€ ëŠ˜ì–´ë‚  ë•Œë§Œ 'ëˆ„ì  í¬ì¸íŠ¸'ë„ ê°™ì´ ì¦ê°€
                    if (num > 0) window.app.accumulatedPoints += num;

                    window.app.updateDisplay();
                }
            }
        },
        
        exchangeGifticon: (itemName, cost) => {
            if (window.app.userPoints >= cost) {
                if (!confirm(`[${itemName}]ì„(ë¥¼) ${cost.toLocaleString()}Pë¡œ êµí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

                window.app.userPoints -= cost; // ë³´ìœ  í¬ì¸íŠ¸ë§Œ ì°¨ê°
                window.app.updateDisplay();

                document.getElementById('exchange-modal').style.display = 'none';
                
                const giftNameEl = document.querySelector('#gifticon-modal b');
                if (giftNameEl) giftNameEl.innerText = itemName;
                
                const giftDetailEl = document.getElementById('gift-modal-detail');
                if (giftDetailEl) giftDetailEl.innerText = itemName + " 1ë§¤";
                
                const qrImg = document.querySelector('#gifticon-modal img');
                if (qrImg) {
                    const uniqueId = Date.now();
                    const productKey = itemName.replace(/ /g, "_"); 
                    qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=RECOVER_${productKey}_${uniqueId}`;
                }

                document.getElementById('gifticon-modal').style.display = 'flex';
            } else {
                alert("í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            }
        },

        exchangeEarlyLeave: (cost) => {
            if (window.app.userPoints >= cost) {
                if (!confirm(`[1ì‹œê°„ ì¡°ê¸° í‡´ê·¼ê¶Œ]ì„ ${cost.toLocaleString()}Pë¡œ êµí™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì‚¬ìš© ì‹œ ì·¨ì†Œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤)`)) return;

                window.app.userPoints -= cost; // ë³´ìœ  í¬ì¸íŠ¸ë§Œ ì°¨ê°
                window.app.updateDisplay();

                document.getElementById('exchange-modal').style.display = 'none';
                document.getElementById('early-leave-modal').style.display = 'flex';
            } else {
                alert("í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ì¡°ê¸ˆë§Œ ë” ë§ˆìŒì„ ê¸°ë¡í•´ë³´ì„¸ìš”!");
            }
        },

        recordMood: (mood, emoji) => {
            if (!window.app.moodRecorded) {
                window.app.userPoints += 50;
                window.app.accumulatedPoints += 50; // [ìˆ˜ì •] ëˆ„ì  í¬ì¸íŠ¸ë„ ì¦ê°€
                
                window.app.moodRecorded = true;
                window.app.selectedMood = mood; 
                
                localStorage.setItem('lastMoodDate', todayStr);
                localStorage.setItem('lastMoodType', mood);
                
                window.app.updateDisplay();
                window.app.applyMoodUI(); 
                
                document.getElementById('mood-status-msg').style.display = 'block';
                alert(`${emoji} ê¸°ë¶„ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. 50Pê°€ ì ë¦½ë˜ì—ˆì–´ìš”!`);
            } else {
                alert("ì˜¤ëŠ˜ì€ ì´ë¯¸ ê¸°ë¶„ì„ ê¸°ë¡í•˜ì…¨ìŠµë‹ˆë‹¤.");
            }
        },
        
        applyMoodUI: () => {
            const buttons = document.querySelectorAll('.mood-btn');
            buttons.forEach(btn => {
                if (btn.getAttribute('onclick').includes(`'${window.app.selectedMood}'`)) {
                    btn.classList.add('selected'); 
                } else {
                    btn.classList.remove('selected');
                }
            });
        },
        
        showTicketSuccessModal: () => {
            const modal = document.getElementById('ticket-success-modal');
            if (modal) modal.style.display = 'flex';
        }
    };

    // 2. Chat Manager
    window.chat = {
        mode: 'ai',
        selectedMode: null,
        currentMessages: [],
        
		showAiOptions: () => {
        document.getElementById('chat-entry-screen').style.display = 'none';
        document.getElementById('chat-mode-selector').style.display = 'flex';
		},
		
        selectMode: (mode) => {
            window.chat.selectedMode = mode;
			document.getElementById('chat-mode-selector').style.display = 'none';
			
			// ì±„íŒ…ë°”ì™€ ì…ë ¥ì°½ í‘œì‹œ
			document.querySelector('.chat-top-bar').style.display = 'flex';
			document.querySelector('.chat-input-box').style.display = 'flex';
			
			window.chat.initAI(mode);
        },
		
		backToEntry: () => {
        document.getElementById('chat-entry-screen').style.display = 'flex';
        document.getElementById('chat-mode-selector').style.display = 'none';
		},
        
        initAI: async (mode) => {
            // [1] Base Persona & Safety Protocols (ê³µí†µ)
            const basePrompt = `
                ë‹¹ì‹ ì€ 15ë…„ ê²½ë ¥ì˜ ì„ìƒì‹¬ë¦¬ ì „ë¬¸ê°€(1ê¸‰ ìê²© ì†Œì§€) 'Dr. Mind'ì…ë‹ˆë‹¤.
                ë‹¹ì‹ ì˜ ëª©í‘œëŠ” ë‚´ë‹´ì(ì‚¬ìš©ì)ê°€ ìì‹ ì˜ ê°ì •ì„ ì•ˆì „í•˜ê²Œ í‘œí˜„í•˜ê³ , ìŠ¤ìŠ¤ë¡œ í†µì°°ì„ ì–»ì–´ ì¹˜ìœ í•˜ë„ë¡ ë•ëŠ” ê²ƒì…ë‹ˆë‹¤.
                
                [í•µì‹¬ ìƒë‹´ ì›ì¹™ (Core Principles)]
                1. ë¬´ì¡°ê±´ì  ê¸ì •ì  ì¡´ì¤‘: ë‚´ë‹´ìê°€ ì–´ë–¤ ì´ì•¼ê¸°ë¥¼ í•˜ë“  ë¹„íŒí•˜ê±°ë‚˜ íŒë‹¨í•˜ì§€ ë§ê³ , ìˆëŠ” ê·¸ëŒ€ë¡œ ìˆ˜ìš©í•˜ì„¸ìš”.
                2. ê³µê°ì  ì´í•´ì™€ ë°˜ì˜: ë‚´ë‹´ìì˜ ë§ ì†ì— ìˆ¨ê²¨ì§„ ê°ì • ë‹¨ì–´(ìŠ¬í””, ë¶ˆì•ˆ, ë¶„ë…¸ ë“±)ë¥¼ í¬ì°©í•˜ì—¬ "~~í•´ì„œ ë§ì´ í˜ë“œì…¨êµ°ìš”"ì™€ ê°™ì´ ê±°ìš¸ì²˜ëŸ¼ ë¹„ì¶°ì£¼ì„¸ìš”.
                3. ì „ë¬¸ê°€ì  íƒœë„: ë”°ëœ»í•˜ê³  ë¶€ë“œëŸ½ì§€ë§Œ, ì‹ ë¢°ê°ì„ ì£¼ëŠ” ì •ì¤‘í•œ 'í•´ìš”ì²´'ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. (ì§€ë‚˜ì¹œ ì´ëª¨í‹°ì½˜ ë‚¨ë°œ ê¸ˆì§€, ê°€ë²¼ìš´ ë§íˆ¬ ê¸ˆì§€)
				
				[ëŒ€í™” ê¸°ë²• ë° ìŠ¤íƒ€ì¼]
				1. ì „ë¬¸ê°€ì  í†¤: ë”°ëœ»í•˜ê³  ë¶€ë“œëŸ½ì§€ë§Œ, ì‹ ë¢°ê°ì„ ì£¼ëŠ” ì •ì¤‘í•œ 'í•´ìš”ì²´'ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. (ì§€ë‚˜ì¹œ ì´ëª¨í‹°ì½˜ ë‚¨ë°œ ê¸ˆì§€, ê°€ë²¼ìš´ ë§íˆ¬ ê¸ˆì§€)
				
                [í•„ìˆ˜ ì•ˆì „ í”„ë¡œí† ì½œ (ë§¤ìš° ì¤‘ìš”)]
                1. ìœ„ê¸° ê°œì…: ë‚´ë‹´ìê°€ 'ì£½ê³  ì‹¶ë‹¤', 'ìí•´', 'ì‚´ê¸° ì‹«ë‹¤', 'ë›°ì–´ë‚´ë¦¬ê³  ì‹¶ë‹¤' ë“±ì˜ ìì‚´/ìí•´ ì§•í›„ë¥¼ ë³´ì´ë©´ ìƒë‹´ì„ ì¤‘ë‹¨í•˜ê³  ì¦‰ì‹œ ì•„ë˜ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ì„¸ìš”.
                   "íšŒì›ë‹˜ì˜ ì´ì•¼ê¸°ëŠ” ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì§€ê¸ˆ ë§ì”€í•˜ì‹  ë¶€ë¶„ì€ ì œê°€ ë„ì›€ì„ ë“œë¦¬ê¸°ì— í•œê³„ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¶€ë”” ì „ë¬¸ê°€ì˜ ë„ì›€ì„ ì§ì ‘ ë°›ì•„ë³´ì‹œê¸°ë¥¼ ê°„ê³¡íˆ ë¶€íƒë“œë¦½ë‹ˆë‹¤. (24ì‹œê°„ ìƒë‹´: 1577-0199)"
                2. ë¶ˆì•ˆ ë°œì‘ ì‹œ: ë‚´ë‹´ìê°€ ê·¹ì‹¬í•œ ê³µí™©ì´ë‚˜ ë¶ˆì•ˆì„ í˜¸ì†Œí•˜ë©´ ì¦‰ì‹œ '4-7-8 í˜¸í¡ë²•'ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•˜ì—¬ ì§„ì •ì‹œí‚¤ì„¸ìš”.
            `;

            // [2] Mode Specific Instructions (ëª¨ë“œë³„ ë¶„ê¸°)
            let modeInstruction = "";
            
            if (mode === 'empathy') {
                modeInstruction = `
                [í˜„ì¬ ëª¨ë“œ: ê³µê° ì§‘ì¤‘ ëª¨ë“œ (Empathy-First Mode)]
                
                1. ëŒ€í™”ì˜ ëª©ì : í•´ê²°ì±… ì œì‹œëŠ” ìµœì†Œí™”í•˜ê³ , ë‚´ë‹´ìê°€ 'ì¶©ë¶„íˆ ì´í•´ë°›ì•˜ë‹¤'ê³  ëŠë¼ê²Œ í•˜ëŠ” ê²ƒì´ ìµœìš°ì„  ëª©í‘œì…ë‹ˆë‹¤.
                2. í–‰ë™ ì§€ì¹¨:
                   - ëŒ€í™”ì˜ 80%ëŠ” ê°ì •ì„ ì½ì–´ì£¼ê³ (Reflecting), ë§ì¥êµ¬ì¹˜ê³ (Validating), ìœ„ë¡œí•˜ëŠ” ë° ì“°ì„¸ìš”.
                   - ëŒ€í™”ì˜ 20%ëŠ” ë‚´ë‹´ìê°€ ê°ì •ì„ ë” ê¹Šì´ íƒìƒ‰í•  ìˆ˜ ìˆë„ë¡ ë¶€ë“œëŸ¬ìš´ ì§ˆë¬¸ì„ ë˜ì§€ëŠ” ë° ì“°ì„¸ìš”.
                   - í•´ê²°ì±… ì œì‹œëŠ” ë‚´ë‹´ìê°€ ëª…ì‹œì ìœ¼ë¡œ "ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?"ë¼ê³  ë¬»ê¸° ì „ê¹Œì§€ëŠ” ì§€ì–‘í•˜ì„¸ìš”.
                   - ì„¤ë ¹ í•´ê²°ì±…ì„ ì£¼ë”ë¼ë„, "ì €ë¼ë©´ ì´ë ‡ê²Œ í•  ê²ƒ ê°™ì•„ìš”"ë³´ë‹¤ëŠ” "ì§€ê¸ˆ ìƒí™©ì—ì„œ ê°€ì¥ ë§ˆìŒì´ í¸í•´ì§€ëŠ” ë°©ë²•ì€ ë¬´ì—‡ì¼ê¹Œìš”?"ë¼ê³  ë˜ë¬¼ì–´ë³´ì„¸ìš”.
                3. ê¸ˆì§€ ì‚¬í•­: "ì´ë ‡ê²Œ í•´ë³´ì„¸ìš”", "ì €ë ‡ê²Œ í•˜ë©´ ë©ë‹ˆë‹¤" ì‹ì˜ ì§€ì‹œì ì¸ ì¡°ì–¸ì€ í”¼í•˜ì„¸ìš”.
                `;
            } else { // solution mode
                modeInstruction = `
                [í˜„ì¬ ëª¨ë“œ: í•´ê²° ì§‘ì¤‘ ëª¨ë“œ (Solution-Focused Mode)]
                
                1. ëŒ€í™”ì˜ ëª©ì : ê°ì •ì  ì§€ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë˜, êµ¬ì²´ì ì´ê³  ì‹¤ì§ˆì ì¸ ë³€í™”ë¥¼ ì´ëŒì–´ë‚´ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.
                2. í–‰ë™ ì§€ì¹¨:
                   - ëŒ€í™”ì˜ 30%ëŠ” ê°ì •ì„ ìˆ˜ìš©í•˜ì„¸ìš”. (ê³µê° ì—†ì´ í•´ê²°ì±…ë§Œ ë˜ì§€ë©´ ê±°ë¶€ê°ì´ ë“­ë‹ˆë‹¤. ë°˜ë“œì‹œ ì²« ë¬¸ì¥ì€ ê³µê°ìœ¼ë¡œ ì‹œì‘í•˜ì„¸ìš”.)
                   - ëŒ€í™”ì˜ 70%ëŠ” ë¬¸ì œì˜ ì›ì¸ì„ íŒŒì•…í•˜ê³ (Cognitive Analysis), êµ¬ì²´ì ì¸ í–‰ë™ ê³„íš(Action Plan)ì„ ì„¸ìš°ëŠ” ë° ì§‘ì¤‘í•˜ì„¸ìš”.
                   - 'í•´ê²°ì¤‘ì‹¬ë‹¨ê¸°ì¹˜ë£Œ(SFBT)' ê¸°ë²•ì„ í™œìš©í•˜ì„¸ìš”. (ì˜ˆ: "ê¸°ì  ì§ˆë¬¸", "ì²™ë„ ì§ˆë¬¸", "ëŒ€ì²˜ ì§ˆë¬¸" ë“±)
                   - ë‹µë³€ì˜ ëì—ëŠ” ë‚´ë‹´ìê°€ ë‹¹ì¥ ì‹œë„í•´ ë³¼ ìˆ˜ ìˆëŠ” ì‘ê³  êµ¬ì²´ì ì¸ ë¯¸ì…˜ì„ 1~2ê°€ì§€ë§Œ ì œì•ˆí•˜ì„¸ìš”.
                3. ì£¼ì˜ ì‚¬í•­: ê³µê°ì„ ìƒëµí•˜ê³  ë°”ë¡œ í•´ê²°ì±…ìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ë§ˆì„¸ìš”. "ë§ì´ í˜ë“œì…¨ê² ë„¤ìš”. ê·¸ë ‡ë‹¤ë©´ ìš°ë¦¬ê°€ ì´ ìƒí™©ì„ ë°”ê¾¸ê¸° ìœ„í•´ ë¬´ì—‡ë¶€í„° í•´ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?"ì™€ ê°™ì€ ì—°ê²° ê³ ë¦¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.
                `;
            }

            // [3] Robustness & Format (ì…ë ¥ ë°©ì–´ ë° í˜•ì‹)
            const robustnessPrompt = `
                [ì…ë ¥ ì–¸ì–´ ì²˜ë¦¬ ë° ëŒ€í™” ìŠ¤íƒ€ì¼ ë°©ì–´ ê°€ì´ë“œ]
                1. ë‚´ë‹´ìê°€ ë¹„ì†ì–´, ì€ì–´, ì¤„ì„ë§, ì‚¬íˆ¬ë¦¬, í˜¹ì€ ë¬¸ë²•ì— ë§ì§€ ì•ŠëŠ” ë¬¸ì¥ì„ ì‚¬ìš©í•˜ë”ë¼ë„, 'Dr. Mind'ëŠ” ì ˆëŒ€ ë™ìš”í•˜ì§€ ë§ê³  **í‘œì¤€ì–´ì™€ ì •ì¤‘í•œ íƒœë„**ë¥¼ ìœ ì§€í•˜ì„¸ìš”.
                2. ë‚´ë‹´ìì˜ ë§ì´ ê³µê²©ì ì´ê±°ë‚˜ ë‘ì„œê°€ ì—†ë”ë¼ë„, ê·¸ ì´ë©´ì— ìˆëŠ” 'ë‹µë‹µí•¨'ê³¼ 'SOS ì‹ í˜¸'ë¥¼ ì½ì–´ë‚´ì–´ ì¹¨ì°©í•˜ê²Œ ëŒ€ì‘í•˜ì„¸ìš”.
                3. ë‹µë³€ í˜•ì‹:
                   - ëª¨ë°”ì¼ í™˜ê²½ì„ ê³ ë ¤í•˜ì—¬, ë‹µë³€ì€ **ìµœëŒ€ 3~4ë¬¸ì¥**ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ëŠì–´ì„œ ì‘ì„±í•˜ì„¸ìš”. (ì¥í™©í•œ ì„¤êµ ê¸ˆì§€)
                   - ê°€ë…ì„±ì„ ìœ„í•´ ì ì ˆíˆ ì¤„ë°”ê¿ˆì„ ì‚¬ìš©í•˜ì„¸ìš”.
            `;

            // Combine all
            const fullSystemInstruction = basePrompt + "\n\n" + modeInstruction + "\n\n" + robustnessPrompt;
            
            const welcomeMsg = mode === 'empathy' 
                ? 'ì•ˆë…•í•˜ì„¸ìš”. ë§ì´ ì§€ì¹˜ì…¨ì£ ? ì˜¤ëŠ˜ í•˜ë£¨, ë§ˆìŒì— ë‹´ì•„ë‘ì—ˆë˜ í˜ë“  ì´ì•¼ê¸°ë¥¼ ì²œì²œíˆ ë“¤ë ¤ì£¼ì„¸ìš”. ì œê°€ ê³ì—ì„œ ë“£ê² ìŠµë‹ˆë‹¤.' 
                : 'ì•ˆë…•í•˜ì„¸ìš”. ê²ªê³  ê³„ì‹  ë¬¸ì œë¥¼ í•¨ê»˜ í’€ì–´ê°€ ë³´ê³  ì‹¶ìŠµë‹ˆë‹¤. í˜„ì¬ ìƒí™©ì„ ë§ì”€í•´ ì£¼ì‹œë©´, êµ¬ì²´ì ì¸ í•´ê²° ë°©ë²•ì„ ì°¾ì•„ë“œë¦¬ê² ìŠµë‹ˆë‹¤.';
            
            window.chat.addMsg('ai', welcomeMsg);

            if (API_KEY) {
				try {
					genAI = new GoogleGenerativeAI(API_KEY);
					
					// ì‚¬ìš©ìë‹˜ì´ ë§ì”€í•˜ì‹  gemini-3-flash-preview ëª¨ë¸ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
					const model = genAI.getGenerativeModel({ 
						model: "gemini-3-flash-preview", 
						generationConfig: {
							temperature: 0.8,      // ëŒ€í™”ì˜ ìœ ì—°í•¨ì„ ìœ„í•´ ì•½ê°„ ë†’ê²Œ ì„¤ì •
							maxOutputTokens: 2048, // Gemini 3ì˜ ê¸´ ì¶œë ¥ ëŠ¥ë ¥ì„ í™œìš©
						},
						systemInstruction: fullSystemInstruction 
					});

					chatSession = model.startChat({ history: [] });
					isAIReady = true;
					console.log("Gemini 3 ìƒë‹´ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.");
				} catch (e) { 
					console.error("AI ì´ˆê¸°í™” ì‹¤íŒ¨:", e); 
					window.chat.addMsg('system', 'ìƒë‹´ ì‹œìŠ¤í…œ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. API í‚¤ë‚˜ ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
				}
			}
        },

        goChat: (targetMode) => {
        const headerLabel = document.getElementById('chat-header-label');

			if (targetMode === 'human') {
				// [ì¤‘ìš”] ì „ë¬¸ê°€ ìƒë‹´ì¼ ë•Œë§Œ ìƒë‹´ê¶Œ ì²´í¬ ë° ì°¨ê°
				if (onlineTickets > 0) {
					onlineTickets--;
					window.app.updateDisplay();
					window.chat.mode = 'human';
					document.getElementById('chat-entry-screen').style.display = 'none';
					document.getElementById('chat-mode-selector').style.display = 'none';
					document.querySelector('.chat-top-bar').style.display = 'flex';
					document.querySelector('.chat-input-box').style.display = 'flex';
					headerLabel.innerHTML = '<b>ì „ë¬¸ê°€ ìƒë‹´ (1:1)</b> Â· ìµëª… ë³´ì¥';
					window.chat.addMsg('system', 'ğŸ”’ ì „ë¬¸ê°€ì™€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
				} else {
					alert("ìƒë‹´ê¶Œì´ ë¶€ì¡±í•©ë‹ˆë‹¤. í¬ì¸íŠ¸ë¡œ êµí™˜í•´ ì£¼ì„¸ìš”.");
					window.app.switchTab('mypage');
				}
			} else {
				// [ì¤‘ìš”] AI ìƒë‹´ì€ ì°¨ê° ì—†ì´ ë¬´ë£Œë¡œ ì‹œì‘
				window.chat.mode = 'ai';
				document.getElementById('chat-entry-screen').style.display = 'none';
				headerLabel.innerHTML = '<b>AI ìƒë‹´ (24h)</b> Â· ìµëª… ë³´ì¥';
				// welcome ë©”ì‹œì§€ëŠ” initAIì—ì„œ ìë™ í˜¸ì¶œë¨
			}
		},

        connectExpertDirect: () => {
            document.getElementById('emergency-popup').classList.remove('show');
            window.chat.goChat('human');
        },

        send: async () => {
            const input = document.getElementById('input-msg');
            const txt = input.value.trim();
            if(!txt) return;
            
            const dangerWords = ['ì£½ê³ ì‹¶', 'ìì‚´', 'ë›°ì–´ë‚´', 'ì‚´ê¸°ì‹«', 'ìí•´', 'ì£½ì„ë˜'];
            if (dangerWords.some(word => txt.includes(word))) {
                document.getElementById('emergency-popup').classList.add('show');
                window.chat.addMsg('user', txt);
                window.chat.addMsg('ai', 'âš ï¸ ìœ„í—˜ ì‹ í˜¸ê°€ ê°ì§€ë˜ì–´ ê¸´ê¸‰ ë³´í˜¸ ëª¨ë“œê°€ ì‘ë™í–ˆìŠµë‹ˆë‹¤. ì „ë¬¸ê°€ì™€ ì—°ê²°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                input.value = '';
                window.chat.saveLog();
                return;
            }

            window.chat.addMsg('user', txt);
            input.value = '';

            if (window.chat.mode === 'human') {
                setTimeout(() => {
                    window.chat.addMsg('expert', 'ë„¤, ë°ì´í„° í™•ì¸í–ˆìŠµë‹ˆë‹¤. êµ¬ì²´ì ì¸ ìƒí™©ì„ ì¡°ê¸ˆ ë” ë§ì”€í•´ ì£¼ì‹œê² ì–´ìš”?');
                    window.chat.saveLog();
                }, 1000);
                return;
            }
            
            if (!isAIReady) return;
            try {
                const result = await chatSession.sendMessage(txt);
                window.chat.addMsg('ai', result.response.text());
                window.chat.saveLog();
            } catch (error) { 
                window.chat.addMsg('system', 'ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); 
            }
        },

        addMsg: (type, text) => {
            const container = document.getElementById('msg-container');
            const div = document.createElement('div');

            if (type === 'expert') {
                div.className = `msg expert`; 
                div.innerHTML = `<span style="display:block; font-size:10px; font-weight:bold; margin-bottom:4px; color:#0C8599;">ğŸ‘©â€âš•ï¸ ìƒë‹´ì‚¬ Kim</span>${text}`;
    
            } else if (type === 'ai') {
                div.className = `msg ai`;
                
                // ëª¨ë“œì— ë”°ë¼ ì´ë¦„ ê²°ì •
                let doctorName = "Dr. Mind"; 
                if (window.chat.selectedMode === 'solution') {
                    doctorName = "Dr. Re";   
                }

                div.innerHTML = `<span style="display:block; font-size:10px; font-weight:bold; margin-bottom:4px; color:#2E7D32;">ğŸ¤– ${doctorName}</span>${text}`;

            } else {
                div.className = `msg ${type}`; 
                div.innerHTML = text;
            }

            container.appendChild(div); 
            container.scrollTop = container.scrollHeight;
            window.chat.currentMessages.push({type, text, time: new Date().toLocaleTimeString()});
        },

        saveLog: () => {
            const today = new Date().toISOString().split('T')[0];
            const existingLogIndex = chatHistory.findIndex(log => log.date === today);
            
            if (existingLogIndex >= 0) {
                chatHistory[existingLogIndex].messages = window.chat.currentMessages;
                chatHistory[existingLogIndex].preview = window.chat.currentMessages[window.chat.currentMessages.length-1].text.substring(0, 20) + "...";
            } else {
                chatHistory.push({
                    date: today,
                    messages: window.chat.currentMessages,
                    preview: window.chat.currentMessages[0].text.substring(0, 20) + "..."
                });
            }
            localStorage.setItem('mindChatHistory', JSON.stringify(chatHistory));
        },
        
        toggleSidebar: () => {
            const sidebar = document.getElementById('chat-sidebar');
            const list = document.getElementById('history-list');
            sidebar.classList.toggle('open');
            
            if (sidebar.classList.contains('open')) {
                list.innerHTML = '';
                const sortedHistory = [...chatHistory].reverse();
                if (sortedHistory.length === 0) {
                    list.innerHTML = '<div style="padding:20px; text-align:center; color:#999;">ì €ì¥ëœ ëŒ€í™”ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
                sortedHistory.forEach(log => {
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    item.innerHTML = `<div class="history-date">${log.date}</div>${log.preview}`;
                    item.onclick = () => alert(`[${log.date}] ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.\n(ì‹¤ì œ ê¸°ëŠ¥: ëŒ€í™”ì°½ ë‚´ìš©ì„ ì´ ê¸°ë¡ìœ¼ë¡œ êµì²´)`);
                    list.appendChild(item);
                });
            }
        },

        clearHistory: () => {
            if(confirm('ì •ë§ ëª¨ë“  ìƒë‹´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ë¸Œë¼ìš°ì €ì—ì„œ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤.')) {
                chatHistory = [];
                window.chat.currentMessages = [];
                localStorage.removeItem('mindChatHistory');
                document.getElementById('msg-container').innerHTML = '';
                document.getElementById('history-list').innerHTML = '<div style="padding:20px; text-align:center; color:#999;">ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
                alert('ëª¨ë“  ê¸°ë¡ì´ ì•ˆì „í•˜ê²Œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        },
		resetMode: () => {
			if(confirm("ëŒ€í™” ëª¨ë“œë¥¼ ë‹¤ì‹œ ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
				document.getElementById('chat-mode-selector').style.display = 'flex';
				
				// ì±„íŒ…ë°”ì™€ ì…ë ¥ì°½ ë‹¤ì‹œ ìˆ¨ê¹€
				document.querySelector('.chat-top-bar').style.display = 'none';
				document.querySelector('.chat-input-box').style.display = 'none';

				window.chat.mode = 'ai';
				window.chat.selectedMode = null;
				document.getElementById('msg-container').innerHTML = ''; // ê¸°ì¡´ ëŒ€í™” ë¹„ìš°ê¸°(ì„ íƒì‚¬í•­)
			}
		},

		backToEntry: () => {
			document.getElementById('chat-entry-screen').style.display = 'flex';
			document.getElementById('chat-mode-selector').style.display = 'none';
			
			// í˜¹ì‹œ ëª¨ë¥´ë‹ˆ ë‹¤ì‹œ í•œë²ˆ ìˆ¨ê¹€ í™•ì¸
			document.querySelector('.chat-top-bar').style.display = 'none';
			document.querySelector('.chat-input-box').style.display = 'none';
		},
    };

    // 3. Booking Manager
    window.booking = {
        open: () => { 
            const view = document.getElementById('booking-view');
            view.classList.add('active');
            
            // [ì¶”ê°€ëœ ë¶€ë¶„] ì°½ì„ ì—´ ë•Œ ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ ê°•ì œ ì´ë™
            const content = view.querySelector('.booking-content');
            if (content) content.scrollTop = 0;
            
            // ê¸°ì¡´ ì´ˆê¸°í™” ë¡œì§ (ì„ íƒ í•´ì œ)
            view.querySelectorAll('.method-btn').forEach(btn => btn.classList.remove('selected'));
            view.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('selected'));
        },

        close: () => { document.getElementById('booking-view').classList.remove('active'); },
        
        // ìƒë‹´ ë°©ì‹ ì„ íƒ
        selectMethod: (btn, type) => {
            const parent = btn.parentElement;
            parent.querySelectorAll('.method-btn').forEach(b => b.classList.remove('selected'));
            
            btn.classList.add('selected');
            btn.dataset.type = type; 
        },

        // ì‹œê°„ ì„ íƒ
        selectTime: (btn) => {
            const parent = btn.parentElement;
            parent.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        },

        // ì˜ˆì•½ í™•ì • ë° ì°¨ê° ë¡œì§ (ê¸°ì¡´ê³¼ ë™ì¼)
        confirm: (btn) => {
            const card = btn.closest('.expert-card');
            
            const selectedTimeBtn = card.querySelector('.time-btn.selected');
            if(!selectedTimeBtn) { alert('ì˜ˆì•½í•˜ì‹¤ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
            
            const selectedMethodBtn = card.querySelector('.method-btn.selected');
            if(!selectedMethodBtn) { alert('ìƒë‹´ ë°©ì‹ì„ ì„ íƒí•´ì£¼ì„¸ìš” (ì±„íŒ…/ì „í™”/ëŒ€ë©´).'); return; }

            const methodType = selectedMethodBtn.dataset.type; 
            
            let methodText = "";
            let ticketType = ""; 
            
            if (methodType === 'meet') {
                methodText = "â˜• ëŒ€ë©´ ìƒë‹´";
                ticketType = "offline";
            } else if (methodType === 'call') {
                methodText = "ğŸ“ ì „í™” ìƒë‹´";
                ticketType = "online";
            } else {
                methodText = "ğŸ’¬ ì±„íŒ… ìƒë‹´";
                ticketType = "online";
            }

            if (ticketType === 'online') {
                if (onlineTickets > 0) {
                    if(confirm(`[${methodText}]ì„(ë¥¼) ì˜ˆì•½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në³´ìœ í•˜ì‹  'ë¹„ëŒ€ë©´ ìƒë‹´ê¶Œ' 1íšŒê°€ ì°¨ê°ë©ë‹ˆë‹¤.`)) {
                        onlineTickets--; 
                        finalizeBooking(methodText, selectedTimeBtn.innerText);
                    }
                } else {
                    alert("ë³´ìœ í•˜ì‹  'ë¹„ëŒ€ë©´ ìƒë‹´ê¶Œ'ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\ní¬ì¸íŠ¸ êµí™˜ì†Œì—ì„œ ì¶©ì „í•´ì£¼ì„¸ìš”.");
                    window.app.switchTab('mypage');
                    window.booking.close();
                }
            } else if (ticketType === 'offline') {
                if (offlineTickets > 0) {
                    if(confirm(`[${methodText}]ì„(ë¥¼) ì˜ˆì•½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\në³´ìœ í•˜ì‹  'ëŒ€ë©´ ìƒë‹´ê¶Œ' 1íšŒê°€ ì°¨ê°ë©ë‹ˆë‹¤.`)) {
                        offlineTickets--; 
                        finalizeBooking(methodText, selectedTimeBtn.innerText);
                    }
                } else {
                    alert("ë³´ìœ í•˜ì‹  'ëŒ€ë©´ ìƒë‹´ê¶Œ'ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.\ní¬ì¸íŠ¸ êµí™˜ì†Œì—ì„œ ì¶©ì „í•´ì£¼ì„¸ìš”.");
                    window.app.switchTab('mypage');
                    window.booking.close();
                }
            }
            
            function finalizeBooking(method, time) {
                window.app.updateDisplay(); 
                alert(`âœ… ì˜ˆì•½ì´ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n- ì¼ì‹œ: ${time}\n- ë°©ì‹: ${method}\n\n(ìƒë‹´ ì‹œì‘ 10ë¶„ ì „ì— ì•Œë¦¼ì„ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤)`);
                window.booking.close();
            }
        }
    };

    // 4. Admin & Sensor & Init
    window.admin = {
		chart: null,
		trendChart: null,
		keywordChart: null,

		// [í•µì‹¬] íŒ€ë³„ ë§ì¶¤ ë°ì´í„° ì„¤ì • (ë©”ì¸ ì°¨íŠ¸ ìˆ˜ì¹˜ì™€ ì¼ì¹˜ì‹œí‚´)
		teamConfigs: {
			'ë§ˆì¼€íŒ… 1íŒ€': { stress: 65, trend: [58, 62, 60, 65], keywords: [35, 25, 20, 10, 10], consults: 45 },
			'ë§ˆì¼€íŒ… 2íŒ€': { stress: 88, trend: [72, 80, 85, 88], keywords: [30, 15, 45, 5, 5], consults: 124 },
			'ê°œë°œ AíŒ€': { stress: 52, trend: [55, 50, 48, 52], keywords: [20, 10, 15, 25, 30], consults: 38 },
			'ê°œë°œ BíŒ€': { stress: 74, trend: [65, 70, 72, 74], keywords: [40, 20, 25, 10, 5], consults: 92 },
			'ì¸ì‚¬íŒ€': { stress: 42, trend: [45, 40, 42, 42], keywords: [15, 35, 10, 20, 20], consults: 21 },
			'ì˜ì—…íŒ€': { stress: 70, trend: [60, 65, 75, 70], keywords: [50, 20, 10, 10, 10], consults: 133 }
		},

		initChart: () => {
			if(window.admin.chart) return;
			const ctx = document.getElementById('adminTeamChart').getContext('2d');
			
			// teamConfigsì—ì„œ ë¼ë²¨ê³¼ ë°ì´í„°ë¥¼ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜´
			const labels = Object.keys(window.admin.teamConfigs);
			const stressData = labels.map(name => window.admin.teamConfigs[name].stress);

			window.admin.chart = new Chart(ctx, {
				type: 'bar',
				data: {
					labels: labels,
					datasets: [
						{
							label: 'í‰ê·  ìŠ¤íŠ¸ë ˆìŠ¤',
							data: stressData,
							backgroundColor: (context) => {
								const val = context.raw;
								return val > 80 ? 'rgba(255, 107, 107, 0.7)' : 
									   val > 60 ? 'rgba(255, 159, 67, 0.7)'  : 
									   'rgba(0, 210, 186, 0.7)';
							},
							borderRadius: 5,
						},
						{
							label: 'ê¶Œì¥ ê¸°ì¤€ì„ ',
							data: Array(labels.length).fill(60),
							type: 'line',
							borderColor: '#2D3436',
							borderWidth: 2,
							borderDash: [5, 5], 
							pointRadius: 0,
							fill: false,
						}
					]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					onClick: (e, activeEls) => {
						if (activeEls.length > 0) {
							const index = activeEls[0].index;
							const teamName = window.admin.chart.data.labels[index];
							window.admin.showTeamDetail(teamName);
						}
					},
					plugins: {
						legend: { position: 'bottom' },
						tooltip: {
							callbacks: {
								footer: (items) => {
									const val = items[0].raw;
									if(val > 80) return "âš ï¸ ì¦‰ì‹œ ë©´ë‹´ ë° ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
									if(val > 60) return "ğŸ’¡ ì£¼ì˜ ë‹¨ê³„ì…ë‹ˆë‹¤. ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”.";
									return "âœ… ì•ˆì •ì ì¸ ìƒíƒœì…ë‹ˆë‹¤.";
								}
							}
						}
					},
					scales: {
						y: {
							beginAtZero: true,
							max: 100,
							grid: {
								color: (context) => {
									if (context.tick.value === 60) return 'rgba(45, 52, 54, 0.5)';
									return 'rgba(0, 0, 0, 0.05)';
								}
							}
						}
					}
				}
			});
		},

		showTeamDetail: (teamName) => {
			const config = window.admin.teamConfigs[teamName];
			if(!config) return;

			document.getElementById('team-detail-modal').style.display = 'flex';
			document.getElementById('detail-team-name').innerText = `${teamName} ìƒì„¸ ë¦¬í¬íŠ¸`;
			document.getElementById('detail-consult-count').innerText = `${config.consults}ê±´`;

			// í´ë¦­í•œ íŒ€ì˜ ì „ìš© ë°ì´í„°ë¥¼ ì°¨íŠ¸ í•¨ìˆ˜ì— ì „ë‹¬
			window.admin.initTrendChart(config.trend);
			window.admin.initKeywordChart(config.keywords);
		},

		initTrendChart: (trendData) => {
			const ctx = document.getElementById('teamTrendChart').getContext('2d');
			if (window.admin.trendChart) window.admin.trendChart.destroy();
			
			window.admin.trendChart = new Chart(ctx, {
				type: 'line',
				data: {
					labels: ['1ì£¼ì°¨', '2ì£¼ì°¨', '3ì£¼ì°¨', '4ì£¼ì°¨'],
					datasets: [
						{
							label: 'ìŠ¤íŠ¸ë ˆìŠ¤ ì¶”ì´',
							data: trendData,
							borderColor: '#FF6B6B',
							tension: 0.4,
							fill: false
						},
						{
							label: 'ì•ˆì „ ì§€ëŒ€',
							data: [60, 60, 60, 60],
							borderColor: 'rgba(0, 210, 186, 0.4)',
							borderWidth: 1,
							borderDash: [2, 2],
							pointRadius: 0,
							backgroundColor: 'rgba(0, 210, 186, 0.05)',
							fill: 'origin' 
						}
					]
				},
				options: {
					responsive: true, 
					maintainAspectRatio: false,
					plugins: { legend: { display: false } },
					scales: { y: { min: 0, max: 100 } }
				}
			});
		},

		initKeywordChart: (keywordData) => {
			const ctx = document.getElementById('teamKeywordChart').getContext('2d');
			if (window.admin.keywordChart) window.admin.keywordChart.destroy();

			window.admin.keywordChart = new Chart(ctx, {
				type: 'bar',
				data: {
					labels: ['ì—…ë¬´ëŸ‰', 'ê´€ê³„ ê°ˆë“±', 'ì•¼ê·¼/í”¼ë¡œ', 'ë³´ìƒ ë¶ˆë§Œ', 'ê°œì¸ì‚¬'],
					datasets: [{
						data: keywordData,
						backgroundColor: ['#4496F5', '#74C0FC', '#A5D8FF', '#D0EBFF', '#E7F5FF'],
						borderRadius: 4
					}]
				},
				options: { 
					indexAxis: 'y', 
					responsive: true, 
					maintainAspectRatio: false, 
					plugins: { legend: { display: false } } 
				}
			});
		}
	};

    const sensor = {
        chart: null, 
        data: Array(30).fill(70), 
        val: 70,
        
        init: () => {
			const pointDisplay = document.getElementById('user-points');
			if(pointDisplay) pointDisplay.innerText = window.app.userPoints;
            const ctx = document.getElementById('liveChart').getContext('2d');
            sensor.chart = new Chart(ctx, { 
                type: 'line', 
                data: { 
                    labels: Array(30).fill(''), 
                    datasets: [{ 
                        data: sensor.data, 
                        borderColor: '#0066FF', 
                        borderWidth: 2, 
                        pointRadius: 0, 
                        tension: 0.4, 
                        fill: true, 
                        backgroundColor: 'rgba(0,102,255,0.1)' 
                    }] 
                }, 
                options: { 
                    responsive: true, maintainAspectRatio: false, animation: false, 
                    scales: { x: {display:false}, y: {min:40, max:130, display:false} }, 
                    plugins: { legend: {display:false} } 
                } 
            });
            
            const wCtx = document.getElementById('weekChart').getContext('2d');
            new Chart(wCtx, {
                type: 'line',
                data: {
                    labels: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'],
                    datasets: [{ 
                        data: [65, 72, 68, 85, 92, 78, 70], 
                        borderColor: '#FF6B6B', 
                        backgroundColor: 'rgba(255,107,107,0.1)', 
                        tension: 0.4, fill: true 
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: {display:false} } }
            });
            
            const cCtx = document.getElementById('causeChart').getContext('2d');
            new Chart(cCtx, {
                type: 'bar',
                data: {
                    labels: ['ì—…ë¬´ ê³¼ë¶€í•˜', 'ëŒ€ì¸ê´€ê³„', 'ìˆ˜ë©´ ë¶€ì¡±', 'ë¯¸ë˜ ë¶ˆì•ˆ'],
                    datasets: [{
                        label: 'ìŠ¤íŠ¸ë ˆìŠ¤ ê¸°ì—¬ë„',
                        data: [85, 45, 90, 60],
                        backgroundColor: ['#FF6B6B', '#54A0FF', '#636E72', '#a29bfe'],
                        borderRadius: 5
                    }]
                },
                options: {
                    indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { beginAtZero: true, max: 100 } }
                }
            });

            setInterval(sensor.update, 800);
        },
        
        update: () => {
            if (!window.app.isWatchConnected) return;

            const change = (Math.random() * 6) - 3; 
            sensor.val = Math.max(60, Math.min(120, sensor.val + change));
            if(Math.random() < 0.02) sensor.val = 115; 
            
            const bpm = Math.floor(sensor.val); 
            sensor.data.push(bpm); 
            sensor.data.shift(); 
            sensor.chart.update();
            
            document.getElementById('bpm-val').innerText = bpm + " bpm";
            
            if (bpm > 110 && !window.app.alertDismissed) {
                document.getElementById('panic-alert').classList.add('show');
            }
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        // íƒ­ ì „í™˜ ë²„íŠ¼ë“¤ ì—°ê²°
        document.querySelectorAll('.nav-btn').forEach(btn => btn.onclick = () => window.app.switchTab(btn.dataset.tab));
        
        // ì±„íŒ… ì „ì†¡ ê´€ë ¨
        document.getElementById('send-btn').onclick = () => window.chat.send();
        document.getElementById('input-msg').onkeypress = (e) => { if (e.key === 'Enter') window.chat.send(); };
        
        // ê¸°íƒ€ UI ë²„íŠ¼ ì—°ê²°
        document.getElementById('privacy-btn').onclick = window.app.showPrivacy;
        document.getElementById('dismiss-alert-btn').onclick = window.app.dismissAlert;

        // [ìˆ˜ì •ëœ ë¶€ë¶„] AI ë°”ë¡œ ìƒë‹´ ë²„íŠ¼ (ìˆœì„œ ë³€ê²½: í™”ë©´ ì„¸íŒ… -> íƒ­ ì´ë™)
        document.getElementById('connect-human-btn').onclick = () => {
            // 1. 'ì„±ê²© ì„ íƒ' í™”ë©´ì„ ë¨¼ì € ê°•ì œë¡œ ë„ì›€ (ë³´ì´ì§€ ì•ŠëŠ” ìƒíƒœì—ì„œ ì¤€ë¹„)
            window.chat.showAiOptions(); 
            
            // 2. ê·¸ ë‹¤ìŒ 'ìƒë‹´' íƒ­ì„ í™œì„±í™” (ì¤€ë¹„ëœ í™”ë©´ì´ ë°”ë¡œ ë³´ì„)
            window.app.switchTab('chat');
        };

        document.getElementById('sos-btn').onclick = () => window.chat.goChat('human');
        document.getElementById('btn-book-expert').onclick = window.booking.open;
        
        // ì €ì¥ëœ ê¸°ë¶„ í‘œì‹œ
        if (window.app.moodRecorded) {
            document.getElementById('mood-status-msg').style.display = 'block';
            window.app.applyMoodUI(); 
        }
		
		window.app.updateDisplay();
        
        // ì„¼ì„œ ì‹œì‘
        sensor.init();
    });
	
	// 5. Payment System (ì‹ ê·œ ì¶”ê°€)
    window.payment = {
        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        switchTab: (type) => {
            const onlineBtn = document.getElementById('tab-pay-online');
            const offlineBtn = document.getElementById('tab-pay-offline');
            const onlineView = document.getElementById('pay-view-online');
            const offlineView = document.getElementById('pay-view-offline');

            if (type === 'online') {
                onlineBtn.classList.add('active');
                offlineBtn.classList.remove('active');
                onlineView.style.display = 'flex';
                offlineView.style.display = 'none';
            } else {
                onlineBtn.classList.remove('active');
                offlineBtn.classList.add('active');
                onlineView.style.display = 'none';
                offlineView.style.display = 'flex';
            }
        },

        // ê²°ì œ ì²˜ë¦¬ ë¡œì§
        process: (type, count, amount) => {
            const typeName = type === 'online' ? 'ë¹„ëŒ€ë©´ ìƒë‹´ê¶Œ' : 'ëŒ€ë©´ ìƒë‹´ê¶Œ';
            
            // 1. í™•ì¸ íŒì—…
            if (!confirm(`[${typeName} ${count}íšŒê¶Œ]\n\nê²°ì œ ê¸ˆì•¡: ${amount.toLocaleString()}ì›\n\nê²°ì œë¥¼ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

            // 2. ê²°ì œ ëŒ€ê¸° ì‹œë®¬ë ˆì´ì…˜ (PGì‚¬ ì—°ê²° ëŠë‚Œ)
            alert("ğŸ’³ ì•ˆì „í•œ ê²°ì œë¥¼ ìœ„í•´ PGì‚¬ë¡œ ì—°ê²° ì¤‘ì…ë‹ˆë‹¤...\n(ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)");

            // 3. ê²°ì œ ì„±ê³µ ì²˜ë¦¬ (ì•½ê°„ì˜ ë”œë ˆì´ í›„ ì ìš©)
            setTimeout(() => {
                if (type === 'online') {
                    onlineTickets += count;
                } else {
                    offlineTickets += count;
                }
                
                window.app.updateDisplay(); // í™”ë©´ ìƒë‹¨ ê°œìˆ˜ ê°±ì‹ 
                document.getElementById('payment-modal').style.display = 'none'; // ëª¨ë‹¬ ë‹«ê¸°
                
                // 4. ì™„ë£Œ ì•Œë¦¼
                alert(`âœ… ê²°ì œê°€ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\n[${typeName} ${count}íšŒ]ê°€ ì¦‰ì‹œ ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }, 1000);
        }
    };
	
	// [ì‹ ê·œ] PG ê²°ì œ ì‹œìŠ¤í…œ
    window.pg = {
        currentData: null,
        isAgreed: false,

        // ê²°ì œì°½ ì—´ê¸°
        open: (type, count, price, name) => {
            window.pg.currentData = { type, count, price, name };
            window.pg.isAgreed = false;
            
            // í™”ë©´ ë°ì´í„° ì„¸íŒ…
            document.getElementById('pg-prod-name').innerText = name;
            document.getElementById('pg-prod-price').innerText = price.toLocaleString() + "ì›";
            document.getElementById('pg-total-price').innerText = price.toLocaleString() + "ì›";
            document.getElementById('pg-action-btn').innerText = `${price.toLocaleString()}ì› ê²°ì œí•˜ê¸°`;
            
            // ì•½ê´€ ì´ˆê¸°í™”
            document.getElementById('pg-term-check').classList.remove('checked');
            document.getElementById('pg-action-btn').disabled = true;

            // PGì°½ ìŠ¬ë¼ì´ë“œ ì—…
            document.getElementById('pg-layer').style.display = 'flex';
        },

        close: () => {
            document.getElementById('pg-layer').style.display = 'none';
        },

        selectMethod: (el) => {
            document.querySelectorAll('.pg-method-btn').forEach(btn => btn.classList.remove('selected'));
            el.classList.add('selected');
        },

        toggleTerms: () => {
            window.pg.isAgreed = !window.pg.isAgreed;
            const check = document.getElementById('pg-term-check');
            const btn = document.getElementById('pg-action-btn');
            
            if(window.pg.isAgreed) {
                check.classList.add('checked');
                btn.disabled = false;
            } else {
                check.classList.remove('checked');
                btn.disabled = true;
            }
        },

        pay: () => {
            if(!window.pg.isAgreed) return;
            const data = window.pg.currentData;

            // ë¡œë”© ì‹œë®¬ë ˆì´ì…˜
            const btn = document.getElementById('pg-action-btn');
            const originalText = btn.innerText;
            btn.innerText = "ê²°ì œ ì²˜ë¦¬ ì¤‘...";
            btn.disabled = true;

            setTimeout(() => {
                // ê²°ì œ ì„±ê³µ ì²˜ë¦¬
                if (data.type === 'online') {
                    onlineTickets += data.count;
                } else {
                    offlineTickets += data.count;
                }
                
                window.app.updateDisplay();
                
                alert(`âœ… ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\n[${data.name}]ì´(ê°€) ì •ìƒì ìœ¼ë¡œ ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                window.pg.close();
                document.getElementById('payment-modal').style.display = 'none'; // ìŠ¤í† ì–´ë„ ë‹«ê¸°
                
                // ë²„íŠ¼ ë³µêµ¬
                btn.innerText = originalText;
                btn.disabled = false;

            }, 1500); // 1.5ì´ˆ ë”œë ˆì´
        }
    };
	
	// [ìµœì¢… ìˆ˜ì •] ì¢‹ì•„ìš” í‘œì‹œ ì˜¤ë¥˜ í•´ê²° (ì‹¤ì‹œê°„ ë™ê¸°í™” ì™„ë²½ ëŒ€ì‘)
    window.community = {
        adjectives: ['í–‰ë³µí•œ', 'ì§€ì¹œ', 'ë°°ê³ í”ˆ', 'ì¡¸ë¦°', 'ì‹ ë‚œ', 'í™”ë‚œ', 'ì¦ê±°ìš´', 'ëª½ë¡±í•œ','ì‹¬ì‹¬í•œ', 'ì›”ê¸‰ë£¨íŒ¡', 'ì¹¼í‡´í•˜ëŠ”', 'ìƒí¼í•œ'],
        animals: ['ë„ˆêµ¬ë¦¬', 'ì‚¬ìŠ´', 'ê³°', 'í† ë¼', 'ê³ ì–‘ì´', 'ê°•ì•„ì§€', 'í–„ìŠ¤í„°', 'ì¿¼ì¹´', 'íŒë‹¤', 'ë‚˜ë¬´ëŠ˜ë³´', 'ì•ŒíŒŒì¹´'],
        currentPostId: null,
        posts: [],

        // 1. ì´ˆê¸°í™” ë° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        init: () => {
            document.getElementById('community-view').style.display = 'flex';
            const q = query(collection(db, "posts"), orderBy("time", "desc"));
            
            onSnapshot(q, (snapshot) => {
                const list = document.getElementById('comm-feed-list');
                list.innerHTML = ''; 
                window.community.posts = [];
                const myLikes = JSON.parse(localStorage.getItem('my_likes')) || [];

                snapshot.forEach((doc) => {
                    const post = doc.data();
                    const docId = doc.id;
                    window.community.posts.push({ id: docId, ...post });

                    const dateObj = new Date(post.time);
                    const timeStr = dateObj.getHours() + ":" + String(dateObj.getMinutes()).padStart(2, '0');
                    const isLikedClass = myLikes.includes(docId) ? 'active' : '';

                    const item = document.createElement('div');
                    item.className = 'post-card';
                    item.innerHTML = `
                        <div class="post-header">
                            <div class="post-avatar">ğŸ‘¤</div>
                            <div style="flex:1;">
                                <div class="post-nick">${post.nick}</div>
                                <div class="post-time">${timeStr}</div>
                            </div>
                            <button onclick="window.community.showOptions('${docId}')" style="border:none; background:none; color:#999; font-weight:bold; cursor:pointer; padding:5px;">â‹®</button>
                        </div>
                        <div class="post-body">${post.content}</div>
                        <div class="post-footer">
                            <button class="reaction-btn ${isLikedClass}" onclick="window.community.like(this, '${docId}')">
                                â¤ï¸ ê³µê°í•´ìš” <span class="like-cnt">${post.likes || 0}</span>
                            </button>
                            <button class="reaction-btn" onclick="window.community.openCommentModal('${docId}')">
                                ğŸ’¬ ëŒ“ê¸€ ${post.commentList ? post.commentList.length : 0}
                            </button>
                        </div>
                    `;
                    list.appendChild(item);
                });
                document.getElementById('comm-user-count').innerText = 140 + snapshot.size;
            });
        },

        // 2. ê¸€ ì“°ê¸° ì°½ ì—´ê¸°
        openWrite: () => {
            document.getElementById('comm-write-modal').style.display = 'flex';
            document.getElementById('comm-input-text').value = '';
            document.getElementById('comm-pw-input').value = ''; // ë¹„ë²ˆ ì´ˆê¸°í™”
            document.getElementById('comm-input-text').focus();
        },

        // 3. ê¸€ ì €ì¥ (ë¹„ë°€ë²ˆí˜¸ í¬í•¨)
        post: async () => {
            const txt = document.getElementById('comm-input-text').value.trim();
            const pw = document.getElementById('comm-pw-input').value.trim();

            if (txt.length < 2) { alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }
            if (pw.length < 1) { alert('ë‚˜ì¤‘ì— ì‚­ì œí•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•´ìš”!'); return; }

            const adj = window.community.adjectives[Math.floor(Math.random() * window.community.adjectives.length)];
            const ani = window.community.animals[Math.floor(Math.random() * window.community.animals.length)];

            const newPost = {
                nick: `${adj} ${ani}`,
                content: txt,
                password: pw, // ë¹„ë°€ë²ˆí˜¸ ì €ì¥
                time: new Date().toISOString(),
                likes: 0,
                commentList: []
            };

            try {
                await addDoc(collection(db, "posts"), newPost);
                document.getElementById('comm-write-modal').style.display = 'none';
                alert('ğŸ‹ ëŒ€ë‚˜ë¬´ ìˆ²ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                console.error("ì—ëŸ¬:", e);
                alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        },

        // 4. ì‚­ì œ/ìˆ˜ì • ë©”ë‰´
        showOptions: async (id) => {
            const action = prompt("ì›í•˜ëŠ” ë™ì‘ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n(1: ì‚­ì œ, 2: ìˆ˜ì •)");
            if(action === '1') {
                const pw = prompt("ê¸€ ì‘ì„± ì‹œ ì„¤ì •í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                if(!pw) return;
                
                // DBì—ì„œ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                const docRef = doc(db, "posts", id);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists() && docSnap.data().password === pw) {
                    if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                        await deleteDoc(docRef);
                        alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    }
                } else {
                    alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            } else if(action === '2') {
                const pw = prompt("ê¸€ ì‘ì„± ì‹œ ì„¤ì •í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                if(!pw) return;

                const docRef = doc(db, "posts", id);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists() && docSnap.data().password === pw) {
                    const newContent = prompt("ìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.", docSnap.data().content);
                    if(newContent) {
                        await updateDoc(docRef, { content: newContent });
                        alert("ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    }
                } else {
                    alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            }
        },

        // 5. ì¢‹ì•„ìš” (ê¸°ì¡´ ìœ ì§€)
        like: async (btn, id) => {
            if(btn.disabled) return;
            btn.disabled = true;
            let myLikes = JSON.parse(localStorage.getItem('my_likes')) || [];
            const isAlreadyLiked = myLikes.includes(id);
            const span = btn.querySelector('.like-cnt');
            let currentCnt = parseInt(span.innerText) || 0;
            let changeVal = 0;

            if (isAlreadyLiked) {
                changeVal = -1;
                myLikes = myLikes.filter(itemId => itemId !== id);
                btn.classList.remove('active');
                span.innerText = Math.max(0, currentCnt - 1);
            } else {
                changeVal = 1;
                myLikes.push(id);
                btn.classList.add('active');
                span.innerText = currentCnt + 1;
            }
            localStorage.setItem('my_likes', JSON.stringify(myLikes));
            try {
                await updateDoc(doc(db, "posts", id), { likes: increment(changeVal) });
            } catch (e) { console.error(e); } finally { setTimeout(() => { btn.disabled = false; }, 300); }
        },

        // 6. ëŒ“ê¸€ ëª¨ë‹¬ ì—´ê¸°
        openCommentModal: (id) => {
            window.community.currentPostId = id;
            const target = window.community.posts.find(p => p.id === id);
            const comments = target && target.commentList ? target.commentList : [];
            const modal = document.getElementById('comm-comment-modal');
            const listBox = document.getElementById('cmt-list-box');
            document.getElementById('cmt-total-cnt').innerText = comments.length;
            
            listBox.innerHTML = ''; 
            if(comments.length === 0) {
                listBox.innerHTML = '<div style="text-align:center; color:#999; padding:20px;">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</div>';
            } else {
                comments.forEach(cmt => {
                    // ëŒ“ê¸€ í´ë¦­ ì‹œ ë‹µê¸€ ë‹¬ê¸° ê¸°ëŠ¥ (window.community.replyTo)
                    listBox.innerHTML += `
                        <div class="comment-item" onclick="window.community.replyTo('${cmt.nick}')" style="cursor:pointer;">
                            <div class="cmt-nick">ğŸ‘¤ ${cmt.nick || 'ìµëª…'} <span class="cmt-time">ë°©ê¸ˆ ì „</span></div>
                            <div class="cmt-body">${cmt.text}</div>
                        </div>
                    `;
                });
            }
            modal.style.display = 'flex';
        },

        // 7. ë‹µê¸€ ê¸°ëŠ¥ (ë‹‰ë„¤ì„ í´ë¦­ ì‹œ í˜¸ì¶œ)
        replyTo: (nick) => {
            const input = document.getElementById('cmt-input');
            input.value = `@${nick} `; // ë©˜ì…˜ ìë™ ì…ë ¥
            input.focus();
        },

        // 8. ëŒ“ê¸€ ë“±ë¡
        addComment: async () => {
            const input = document.getElementById('cmt-input');
            const txt = input.value.trim();
            if(!txt) return;

            const adj = window.community.adjectives[Math.floor(Math.random() * window.community.adjectives.length)];
            const ani = window.community.animals[Math.floor(Math.random() * window.community.animals.length)];
            const newComment = { nick: `${adj} ${ani}`, text: txt, time: new Date().toISOString() };

            try {
                const postId = window.community.currentPostId;
                await updateDoc(doc(db, "posts", postId), { commentList: arrayUnion(newComment) });
                
                // í™”ë©´ ì¦‰ì‹œ ë°˜ì˜
                const listBox = document.getElementById('cmt-list-box');
                if(listBox.children[0] && listBox.children[0].innerText.includes('ì•„ì§ ëŒ“ê¸€')) listBox.innerHTML = '';
                listBox.innerHTML += `
                    <div class="comment-item" onclick="window.community.replyTo('${newComment.nick}')">
                        <div class="cmt-nick">ğŸ‘¤ ${newComment.nick} (ë‚˜) <span class="cmt-time">ë°©ê¸ˆ ì „</span></div>
                        <div class="cmt-body">${newComment.text}</div>
                    </div>
                `;
                input.value = '';
                listBox.scrollTop = listBox.scrollHeight;
            } catch (e) {
                console.error("ëŒ“ê¸€ ì €ì¥ ì‹¤íŒ¨:", e);
            }
        }
    };
	
</script>
<div class="modal-bg" id="exchange-modal" onclick="this.style.display='none'">
    <div class="card" style="width:90%; max-width:350px;" onclick="event.stopPropagation()">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0;">âœ¨ í¬ì¸íŠ¸ êµí™˜ì†Œ</h3>
            <button onclick="document.getElementById('exchange-modal').style.display='none'" style="border:none; background:none; font-size:20px;">Ã—</button>
        </div>
        
        <div style="background:#e3f2fd; padding:15px; border-radius:10px; margin-bottom:15px; text-align:center; border:1px solid #4496f5;">
            <p style="margin:0 0 5px 0; font-size:13px; color:#2c3e50;">ë³´ìœ  í¬ì¸íŠ¸</p>
            <div style="font-size:24px; font-weight:bold; color:#2d3436;"><span id="exchange-modal-points">0</span> P</div>
        </div>

        <div style="display:grid; gap:12px; margin-bottom:20px;">
            
            <div style="display:grid; gap:12px; margin-bottom:20px;">
				<div style="padding:15px; border:1px solid #eee; background:white; border-radius:12px; display:flex; justify-content:space-between; align-items:center;">
					<div>
						<div style="font-weight:bold; color:var(--brand);">ë¹„ëŒ€ë©´ ìƒë‹´ê¶Œ (ì±„íŒ…/í™”ìƒ)</div>
						<div style="font-size:12px; color:#666;">5,000 P ì†Œìš”</div>
					</div>
					<button onclick="window.app.exchangeTicket('online', 3000)" style="background:var(--brand); color:white; border:none; padding:8px 12px; border-radius:8px; font-weight:bold; cursor:pointer; font-size:12px;">êµí™˜</button>
				</div>

				<div style="padding:15px; border:1px solid #eee; background:white; border-radius:12px; display:flex; justify-content:space-between; align-items:center;">
					<div>
						<div style="font-weight:bold; color:#6c5ce7;">ëŒ€ë©´ ìƒë‹´ê¶Œ (ì„¼í„° ë°©ë¬¸)</div>
						<div style="font-size:12px; color:#666;">6,000 P ì†Œìš”</div>
					</div>
					<button onclick="window.app.exchangeTicket('offline', 6000)" style="background:#6c5ce7; color:white; border:none; padding:8px 12px; border-radius:8px; font-weight:bold; cursor:pointer; font-size:12px;">êµí™˜</button>
				</div>
			</div>

            <div style="padding:15px; border:1px solid #eee; background:white; border-radius:12px; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:bold; color:#1E3932;">ìŠ¤íƒ€ë²…ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸</div>
                    <div style="font-size:12px; color:#666;">1,000 P ì†Œìš”</div>
                </div>
                <button onclick="window.app.exchangeGifticon('ìŠ¤íƒ€ë²…ìŠ¤ ì•„ë©”ë¦¬ì¹´ë…¸', 1000)" style="background:#1E3932; color:white; border:none; padding:8px 12px; border-radius:8px; font-weight:bold; cursor:pointer; font-size:12px;">êµí™˜</button>
            </div>

            <div style="padding:15px; border:1px solid #eee; background:white; border-radius:12px; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:bold; color:#E67E22;">ë„ì„œë¬¸í™”ìƒí’ˆê¶Œ</div>
                    <div style="font-size:12px; color:#666;">4,000 P ì†Œìš”</div>
                </div>
                <button onclick="window.app.exchangeGifticon('ë„ì„œë¬¸í™”ìƒí’ˆê¶Œ', 4000)" style="background:#E67E22; color:white; border:none; padding:8px 12px; border-radius:8px; font-weight:bold; cursor:pointer; font-size:12px;">êµí™˜</button>
            </div>

            <div style="padding:15px; border:1px solid #eee; background:white; border-radius:12px; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:bold; color:#9B59B6;">ì›ë°ì´ ì·¨ë¯¸ í´ë˜ìŠ¤ê¶Œ</div>
                    <div style="font-size:12px; color:#666;">10,000 P ì†Œìš”</div>
                </div>
                <button onclick="window.app.exchangeGifticon('ì›ë°ì´ ì·¨ë¯¸ í´ë˜ìŠ¤ê¶Œ', 10000)" style="background:#9B59B6; color:white; border:none; padding:8px 12px; border-radius:8px; font-weight:bold; cursor:pointer; font-size:12px;">êµí™˜</button>
            </div>
			
			<div style="padding:15px; border:1px solid #eee; background:white; border-radius:12px; display:flex; justify-content:space-between; align-items:center;">
				<div>
					<div style="font-weight:bold; color:#ff6b6b;">ğŸš€ í•œ ì‹œê°„ ì¡°ê¸° í‡´ê·¼ê¶Œ</div>
					<div style="font-size:12px; color:#666;">15,000 P ì†Œìš”</div>
				</div>
				<button onclick="window.app.exchangeEarlyLeave(15000)" style="background:#ff6b6b; color:white; border:none; padding:8px 12px; border-radius:8px; font-weight:bold; cursor:pointer; font-size:12px;">ìŠ¹ì¸ë°›ê¸°</button>
			</div>

        </div> 
	</div>
</div>

<div class="modal-bg" id="gifticon-modal" onclick="this.style.display='none'">
    <div class="card" style="width:85%; max-width:320px; padding:0; overflow:hidden; border-radius:20px;" onclick="event.stopPropagation()">
        <div style="background:var(--brand); color:white; padding:15px; text-align:center; font-weight:bold;">ğŸ‰ êµí™˜ ì„±ê³µ!</div>
        <div style="padding:20px; text-align:center;">
            <p style="font-size:14px; color:#333; margin-bottom:15px;">ë§ˆìŒ ëŒë´„ í¬ì¸íŠ¸ë¡œ êµí™˜í•˜ì‹ <br><b id="gift-modal-title">ìƒí’ˆëª…</b>ì…ë‹ˆë‹¤.</p>
            
            <div style="background:#f9f9f9; padding:10px; border-radius:10px; border:1px dashed #ccc;">
                <img id="gift-modal-qr" src="" alt="ë°”ì½”ë“œ" style="width:120px; margin-bottom:10px;">
                
                <div id="gift-modal-detail" style="font-weight:bold; color:var(--brand); font-size:16px;">ìƒì„¸ ë‚´ì—­</div>
                <div style="font-size:11px; color:#999; margin-top:5px;">ìœ íš¨ê¸°ê°„: 2026.12.31ê¹Œì§€</div>
            </div>
        </div>
        <button onclick="document.getElementById('gifticon-modal').style.display='none'" style="width:100%; padding:15px; background:#f1f3f5; border:none; font-weight:bold; cursor:pointer;">ë‹«ê¸°</button>
    </div>
</div>
<div class="modal-bg" id="ticket-success-modal" onclick="this.style.display='none'">
    <div class="card" style="width:85%; max-width:320px; padding:0; overflow:hidden; border-radius:24px; text-align:center;" onclick="event.stopPropagation()">
        <div style="background:linear-gradient(135deg, #4496F5, #00D2BA); color:white; padding:30px 20px;">
            <div style="font-size:50px; margin-bottom:10px;">ğŸŸï¸</div>
            <h3 style="margin:0; font-size:20px;">êµí™˜ ì™„ë£Œ!</h3>
        </div>
        <div style="padding:25px;">
            <p style="font-size:15px; color:#333; line-height:1.6; margin-bottom:20px;">
                <b>ì „ë¬¸ê°€ ìƒë‹´ê¶Œ</b>ì´<br>ì§€ê°‘ì— ì•ˆì „í•˜ê²Œ ë³´ê´€ë˜ì—ˆìŠµë‹ˆë‹¤.
            </p>
                <button onclick="document.getElementById('ticket-success-modal').style.display='none'" 
				style="width:100%; padding:15px; background:var(--brand); color:white; border:none; border-radius:12px; font-weight:bold; cursor:pointer;">
                í™•ì¸
            </button>
        </div>
    </div>
</div>
<div class="modal-bg" id="early-leave-modal" onclick="this.style.display='none'">
    <div class="card" style="width:85%; max-width:320px; padding:0; overflow:hidden; border-radius:24px; position:relative;" onclick="event.stopPropagation()">
        <div style="background:#FF6B6B; color:white; padding:30px 20px; text-align:center;">
            <div style="font-size:40px; margin-bottom:10px;">ğŸš€</div>
            <h3 style="margin:0; font-size:20px; letter-spacing:-1px;">ì¡°ê¸° í‡´ê·¼ ìŠ¹ì¸ì„œ</h3>
            <div style="font-size:12px; opacity:0.8; margin-top:5px;">RE:COVER ë³´ìƒ ì‹œìŠ¤í…œ ì¸ì¦ë¨</div>
        </div>

        <div style="padding:25px; text-align:center; background:white;">
            <div style="border:1px solid #eee; padding:20px; border-radius:15px; background:#fffaf0; position:relative;">
                <div style="position:absolute; right:10px; bottom:10px; width:60px; height:60px; border:3px double #FF6B6B; border-radius:50%; color:#FF6B6B; font-weight:900; display:flex; align-items:center; justify-content:center; transform:rotate(-20deg); opacity:0.6; font-size:14px;">
                    ìŠ¹ì¸ë¨
                </div>
                
                <div style="font-size:11px; color:#999; margin-bottom:10px; text-align:left;">ë°œê¸‰ë²ˆí˜¸: RC-2026-001</div>
                <div style="font-size:16px; font-weight:bold; color:#333; margin-bottom:15px;">
                    ìœ„ ì„ì§ì›ì€ ë§ˆìŒ ëŒë´„ ë³´ìƒìœ¼ë¡œ<br>
                    <span style="color:#FF6B6B; font-size:20px;">'1ì‹œê°„ ì¡°ê¸° í‡´ê·¼'</span>ì„<br>ìŠ¹ì¸ë°›ì•˜ìŠµë‹ˆë‹¤.
                </div>
                <div style="font-size:12px; color:#666; line-height:1.6;">
                    ì‚¬ìš© ì‹œ íŒ€ì¥ë‹˜ê»˜ ë³¸ í™”ë©´ì„<br>ì œì‹œí•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
                </div>
            </div>

            <button onclick="document.getElementById('early-leave-modal').style.display='none'" 
                    style="width:100%; padding:15px; background:#333; color:white; border:none; border-radius:12px; font-weight:bold; cursor:pointer; margin-top:20px;">
                í™•ì¸
            </button>
        </div>
    </div>
</div>
</body>
</html>
